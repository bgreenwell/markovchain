<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The markovchain Package: A Package for Easily Handling Discrete Markov Chains in R • markovchain</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The markovchain Package: A Package for Easily Handling Discrete Markov Chains in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">markovchain</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.9.16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GSoC-2017_additions.html">GSoC-2017_Additions</a>
    </li>
    <li>
      <a href="../articles/an_introduction_to_markovchain_package.html">The markovchain Package: A Package for Easily Handling Discrete Markov Chains in R</a>
    </li>
    <li>
      <a href="../articles/complicate_steady_states_analysis.html">Complicate Steady States Analysis</a>
    </li>
    <li>
      <a href="../articles/higher_order_markov_chains.html">Higher order (multivariate) Markov chains</a>
    </li>
    <li>
      <a href="../articles/markovchainCrashIntro.pdf">Crash Introduction to markovchain R package (PDF)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/spedygiorgio/markovchain">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>The markovchain Package: A Package for Easily Handling Discrete Markov Chains in R</h1>
                        <h4 class="author">Giorgio Alfredo Spedicato</h4>
            <address class="author_afil">
      Ph.D C.Stat FCAS, FSA, CSPA UnipolSai R&amp;D<br><h4 class="author">Tae Seung Kang</h4>
            <address class="author_afil">
      Ph.D student, Computer &amp; Information Science &amp; Engineering<br><h4 class="author">Sai Bhargav Yalamanchi</h4>
            <address class="author_afil">
      B-Tech student, Electrical Engineering<br><h4 class="author">Deepak Yadav</h4>
            <address class="author_afil">
      B-Tech student, Computer Science and Engineering<br><small class="dont-index">Source: <a href="https://github.com/spedygiorgio/markovchain/blob/master/vignettes/an_introduction_to_markovchain_package.Rmd"><code>vignettes/an_introduction_to_markovchain_package.Rmd</code></a></small>
      <div class="hidden name"><code>an_introduction_to_markovchain_package.Rmd</code></div>

    </address>
</address>
</address>
</address>
</div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Markov chains represent a class of stochastic processes of great interest for the wide spectrum of practical applications. In particular, discrete time Markov chains (DTMC) permit to model the transition probabilities between discrete states by the aid of matrices.Various  packages deal with models that are based on Markov chains:</p>
<ul>
<li> <span class="citation">(Jackson 2011)</span> handles Multi-State Models for panel data.</li>
<li> <span class="citation">(Geyer and Johnson 2013)</span> implements Monte Carlo Markov Chain approach.</li>
<li> <span class="citation">(Dr. Lin Himmelmann and www.linhi.com 2010)</span> fits hidden Markov models with covariates.</li>
<li> fits `Multi-State Models based on Markov chains for survival analysis <span class="citation">(Wreede, Fiocco, and Putter 2011)</span>.</li>
</ul>
<p>Nevertheless, the  statistical environment <span class="citation">(R Core Team 2013)</span> seems to lack a simple package that coherently defines S4 classes for discrete Markov chains and allows to perform probabilistic analysis, statistical inference and applications. For the sake of completeness,  is the second package specifically dedicated to DTMC analysis, being  <span class="citation">(Nicholson 2013)</span> the first one. Notwithstanding,  package <span class="citation">(Spedicato 2017)</span> aims to offer more flexibility in handling DTMC than other existing solutions, providing S4 classes for both homogeneous and non-homogeneous Markov chains as well as methods suited to perform statistical and probabilistic analysis.</p>
<p>The  package depends on the following  packages:  <span class="citation">(Goulet et al. 2013)</span> to perform efficient matrices powers;  <span class="citation">(Csardi and Nepusz 2006)</span> to perform pretty plotting of <code>markovchain</code> objects and  <span class="citation">(Roebuck 2011)</span>, that contains functions for matrix management and calculations that emulate those within  environment. Moreover, other scientific softwares provide functions specifically designed to analyze DTMC, as  9 <span class="citation">(Wolfram Research 2013)</span>.</p>
<p>The paper is structured as follows: Section @ref(sec:mathematics) briefly reviews mathematics and definitions regarding DTMC, Section @ref(sec:structure) discusses how to handle and manage Markov chain objects within the package, Section @ref(sec:probability) and Section @ref(sec:statistics) show how to perform probabilistic and statistical modelling, while Section @ref(sec:applications) presents some applied examples from various fields analyzed by means of the  package.</p>
</div>
<div id="sec:mathematics" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:mathematics" class="anchor"></a>Review of core mathematical concepts</h1>
<div id="general-definitions" class="section level2">
<h2 class="hasAnchor">
<a href="#general-definitions" class="anchor"></a>General Definitions</h2>
<p>A DTMC is a sequence of random variables <span class="math inline">\(X_{1},\: X_{2}\: ,\ldots,\:X_{n},\ldots\)</span> characterized by the Markov property (also known as memoryless property, see Equation ). The Markov property states that the distribution of the forthcoming state <span class="math inline">\(X_{n+1}\)</span> depends only on the current state <span class="math inline">\(X_{n}\)</span> and doesn’t depend on the previous ones <span class="math inline">\(X_{n-1},\: X_{n-2},\ldots,\: X_{1}\)</span>.</p>

<p>The set of possible states <span class="math inline">\(S=\left\{ s_{1},s_{2},...,s_{r}\right\}\)</span> of <span class="math inline">\(X_{n}\)</span> can be finite or countable and it is named the state space of the chain.</p>
<p>The chain moves from one state to another (this change is named either ‘transition’ or ‘step’) and the probability <span class="math inline">\(p_{ij}\)</span> to move from state <span class="math inline">\(s_{i}\)</span> to state <span class="math inline">\(s_{j}\)</span> in one step is named transition probability:</p>

<p>The probability of moving from state <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> in <span class="math inline">\(n\)</span> steps is denoted by <span class="math inline">\(p_{ij}^{(n)}=Pr\left(X_{n}=s_{j}\left|X_{0}=s_{i}\right.\right)\)</span>.</p>
<p>A DTMC is called time-homogeneous if the property shown in Equation  holds. Time homogeneity implies no change in the underlying transition probabilities as time goes on. <span class="math display">\[\begin{equation}
Pr\left(X_{n+1}=s_{j}\left|X_{n}=s_{i}\right.\right)=Pr\left(X_{n}=s_{j}\left|X_{n-1}=s_{i}\right.\right).
\label{eq:mcHom}
\end{equation}\]</span></p>
<p>If the Markov chain is time-homogeneous, then <span class="math inline">\(p_{ij}=Pr\left(X_{k+1}=s_{j}\left|X_{k}=s_{i}\right.\right)\)</span> and <span class="math inline">\(p_{ij}^{(n)}=Pr\left(X_{n+k}=s_{j}\left|X_{k}=s_{i}\right.\right)\)</span>, where <span class="math inline">\(k&gt;0\)</span>.</p>
<p>The probability distribution of transitions from one state to another can be represented into a transition matrix <span class="math inline">\(P=(p_{ij})_{i,j}\)</span>, where each element of position <span class="math inline">\((i,j)\)</span> represents the transition probability <span class="math inline">\(p_{ij}\)</span>. E.g., if <span class="math inline">\(r=3\)</span> the transition matrix <span class="math inline">\(P\)</span> is shown in Equation </p>

<p>The distribution over the states can be written in the form of a stochastic row vector <span class="math inline">\(x\)</span> (the term stochastic means that <span class="math inline">\(\sum_{i}x_{i}=1, x_{i} \geq 0\)</span>): e.g., if the current state of <span class="math inline">\(x\)</span> is <span class="math inline">\(s_{2}\)</span>, <span class="math inline">\(x=\left(0\:1\:0\right)\)</span>. As a consequence, the relation between <span class="math inline">\(x^{(1)}\)</span> and <span class="math inline">\(x^{(0)}\)</span> is <span class="math inline">\(x^{(1)}=x^{(0)}P\)</span> and, recursively, we get <span class="math inline">\(x^{(2)}=x^{(0)}P^{2}\)</span> and <span class="math inline">\(x^{(n)}=x^{(0)}P^{n},\, n&gt;0\)</span>.</p>
<p>DTMC are explained in most theory books on stochastic processes, see  and  for example. Valuable references online available are: ,  and .</p>
</div>
<div id="sec:properties" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:properties" class="anchor"></a>Properties and classification of states</h2>
<p>A state <span class="math inline">\(s_{j}\)</span> is said accessible from state <span class="math inline">\(s_{i}\)</span> (written <span class="math inline">\(s_{i}\rightarrow s_{j}\)</span>) if a system starting in state <span class="math inline">\(s_{i}\)</span> has a positive probability to reach the state <span class="math inline">\(s_{j}\)</span> at a certain point, i.e., <span class="math inline">\(\exists n&gt;0:\: p_{ij}^{n}&gt;0\)</span>. If both <span class="math inline">\(s_{i}\rightarrow s_{j}\)</span> and <span class="math inline">\(s_{j}\rightarrow s_{i}\)</span>, then <span class="math inline">\(s_{i}\)</span> and <span class="math inline">\(s_{j}\)</span> are said to communicate.</p>
<p>A communicating class is defined to be a set of states that communicate. A DTMC can be composed by one or more communicating classes. If the DTMC is composed by only one communicating class (i.e., if all states in the chain communicate), then it is said irreducible. A communicating class is said to be closed if no states outside of the class can be reached from any state inside it.</p>
<p>If <span class="math inline">\(p_{ii}=1\)</span>, <span class="math inline">\(s_{i}\)</span> is defined as absorbing state: an absorbing state corresponds to a closed communicating class composed by one state only.</p>
<p>The canonic form of a DTMC transition matrix is a matrix having a block form, where the closed communicating classes are shown at the beginning of the diagonal matrix.</p>
<p>A state <span class="math inline">\(s_{i}\)</span> has period <span class="math inline">\(k_{i}\)</span> if any return to state <span class="math inline">\(s_{i}\)</span> must occur in multiplies of <span class="math inline">\(k_{i}\)</span> steps, that is <span class="math inline">\(k_{i}=gcd\left\{ n:Pr\left(X_{n}=s_{i}\left|X_{0}=s_{i}\right.\right)&gt;0\right\}\)</span>, where <span class="math inline">\(gcd\)</span> is the greatest common divisor. If <span class="math inline">\(k_{i}=1\)</span> the state <span class="math inline">\(s_{i}\)</span> is said to be aperiodic, else if <span class="math inline">\(k_{i}&gt;1\)</span> the state <span class="math inline">\(s_{i}\)</span> is periodic with period <span class="math inline">\(k_{i}\)</span>. Loosely speaking, <span class="math inline">\(s_{i}\)</span> is periodic if it can only return to itself after a fixed number of transitions <span class="math inline">\(k_{i}&gt;1\)</span> (or multiple of <span class="math inline">\(k_{i}\)</span>), else it is aperiodic.</p>
<p>If states <span class="math inline">\(s_{i}\)</span> and <span class="math inline">\(s_{j}\)</span> belong to the same communicating class, then they have the same period <span class="math inline">\(k_{i}\)</span>. As a consequence, each of the states of an irreducible DTMC share the same periodicity. This periodicity is also considered the DTMC periodicity. It is possible to classify states according to their periodicity. Let <span class="math inline">\(T^{x\rightarrow x}\)</span> is the number of periods to go back to state <span class="math inline">\(x\)</span> knowing that the chain starts in <span class="math inline">\(x\)</span>.</p>
<ul>
<li>A state <span class="math inline">\(x\)</span> is recurrent if <span class="math inline">\(P(T^{x\rightarrow x}&lt;+\infty)=1\)</span> (equivalently <span class="math inline">\(P(T^{x\rightarrow x}=+\infty)=0\)</span>). In addition:
<ol style="list-style-type: decimal">
<li>A state <span class="math inline">\(x\)</span> is null recurrent if in addition <span class="math inline">\(E(T^{x\rightarrow x})=+\infty\)</span>.</li>
<li>A state <span class="math inline">\(x\)</span> is positive recurrent if in addition <span class="math inline">\(E(T^{x\rightarrow x})&lt;+\infty\)</span>.</li>
<li>A state <span class="math inline">\(x\)</span> is absorbing if in addition <span class="math inline">\(P(T^{x\rightarrow x}=1)=1\)</span>.</li>
</ol>
</li>
<li>A state <span class="math inline">\(x\)</span> is transient if <span class="math inline">\(P(T^{x\rightarrow x}&lt;+\infty)&lt;1\)</span> (equivalently <span class="math inline">\(P(T^{x\rightarrow x}=+\infty)&gt;0\)</span>).</li>
</ul>
<p>It is possible to analyze the timing to reach a certain state. The first passage time (or hitting time) from state <span class="math inline">\(s_{i}\)</span> to state <span class="math inline">\(s_{j}\)</span> is the number <span class="math inline">\(T_{ij}\)</span> of steps taken by the chain until it arrives for the first time to state <span class="math inline">\(s_{j}\)</span>, given that <span class="math inline">\(X_{0} = s_{i}\)</span>. The probability distribution of <span class="math inline">\(T_{ij}\)</span> is defined by Equation </p>

<p>and can be found recursively using Equation , given that <span class="math inline">\({h_{ij}}^{\left( n \right)} = p_{ij}\)</span>.</p>

<p>A commonly used quantity related to <span class="math inline">\(h\)</span> is its average value, i.e. the  (also expected hitting time), namely <span class="math inline">\(\bar h_{ij}= \sum_{n=1\dots\infty} n \,h_{ij}^{(n)}\)</span>. <!-- TONI --></p>
<p>If in the definition of the first passage time we let <span class="math inline">\(s_{i}=s_{j}\)</span>, we obtain the first return time <span class="math inline">\(T_{i}=\inf \{ n\geq1:X_{n}=s_{i}|X_{0}=s_{i} \}\)</span>. A state <span class="math inline">\(s_{i}\)</span> is said to be recurrent if it is visited infinitely often, i.e., <span class="math inline">\(Pr(T_{i}&lt;+\infty|X_{0}=s_{i})=1\)</span>. On the opposite, <span class="math inline">\(s_{i}\)</span> is called transient if there is a positive probability that the chain will never return to <span class="math inline">\(s_{i}\)</span>, i.e., <span class="math inline">\(Pr(T_{i}=+\infty|X_{0}=s_{i})&gt;0\)</span>.</p>
<p>Given a time homogeneous Markov chain with transition matrix , a stationary distribution  is a stochastic row vector such that <span class="math inline">\(z=z\cdot P\)</span>, where <span class="math inline">\(0\leq z_{j}\leq 1 \: \forall j\)</span> and <span class="math inline">\(\sum_{j}z_{j}=1\)</span>.</p>
<p>If a DTMC <span class="math inline">\(\{X_{n}\}\)</span> is irreducible and aperiodic, then it has a limit distribution and this distribution is stationary. As a consequence, if <span class="math inline">\(P\)</span> is the <span class="math inline">\(k\times k\)</span> transition matrix of the chain and <span class="math inline">\(z=\left(z_{1},...,z_{k}\right)\)</span> is the eigenvector of <span class="math inline">\(P\)</span> such that <span class="math inline">\(\sum_{i=1}^{k}z_{i}=1\)</span>, then we get</p>

<p>where <span class="math inline">\(Z\)</span> is the matrix having all rows equal to <span class="math inline">\(z\)</span>. The stationary distribution of <span class="math inline">\(\{X_{n}\}\)</span> is represented by <span class="math inline">\(z\)</span>.</p>
<p>Given two absorbing states <span class="math inline">\(s_A\)</span> (source) and <span class="math inline">\(s_B\)</span> (sink), the  <span class="math inline">\(q_j^{(AB)}\)</span> is the probability that a process starting in state <span class="math inline">\(s_i\)</span> is absorbed in state <span class="math inline">\(s_B\)</span> (rather than <span class="math inline">\(s_A\)</span>) <span class="citation">(Noé et al. 2009)</span>. It can be computed via <!-- TONI --></p>

<p>Note we can also define the hitting probability from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> as the probability of ever reaching the state <span class="math inline">\(j\)</span> if our initial state is <span class="math inline">\(i\)</span>:</p>

</div>
<div id="a-short-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-short-example" class="anchor"></a>A short example</h2>
<p>Consider the following numerical example. Suppose we have a DTMC with a set of 3 possible states <span class="math inline">\(S=\{s_{1}, s_{2}, s_{3}\}\)</span>. Let the transition matrix be: <span class="math display">\[\begin{equation}
P=\left[\begin{array}{ccc}
0.5 &amp; 0.2 &amp; 0.3\\
0.15 &amp; 0.45 &amp; 0.4\\
0.25 &amp; 0.35 &amp; 0.4
\end{array}\right].
\label{eq:trPropExEx1}
\end{equation}\]</span></p>
<p>In <span class="math inline">\(P\)</span>, <span class="math inline">\(p_{11}=0.5\)</span> is the probability that <span class="math inline">\(X_{1}=s_{1}\)</span> given that we observed <span class="math inline">\(X_{0}=s_{1}\)</span> is 0.5, and so on.It is easy to see that the chain is irreducible since all the states communicate (it is made by one communicating class only).</p>
<p>Suppose that the current state of the chain is <span class="math inline">\(X_{0}=s_{2}\)</span>, i.e., <span class="math inline">\(x^{(0)}=(0\:1\:0)\)</span>, then the probability distribution of states after 1 and 2 steps can be computed as shown in Equations @ref(eq:trPropExEx2) and @ref(eq:trPropExEx3).</p>


<p>If we were interested in the probability of being in the state <span class="math inline">\(s_{3}\)</span> in the second step, then <span class="math inline">\(Pr\left(X_{2}=s_{3}\left|X_{0}=s_{2}\right.\right)=0.385\)</span>.</p>

</div>
</div>
<div id="sec:structure" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:structure" class="anchor"></a>The structure of the package</h1>
<div id="creating-markovchain-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-markovchain-objects" class="anchor"></a>Creating markovchain objects</h2>
<p>The package is loaded within the  command line as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"markovchain"</span>)</a></code></pre></div>
<p>The <code>markovchain</code> and <code>markovchainList</code> S4 classes <span class="citation">(Chambers 2008)</span> are defined within the  package as displayed:</p>
<pre><code>## Class "markovchain" [package "markovchain"]
## 
## Slots:
##                                                                           
## Name:            states            byrow transitionMatrix             name
## Class:        character          logical           matrix        character</code></pre>
<pre><code>## Class "markovchainList" [package "markovchain"]
## 
## Slots:
##                                 
## Name:  markovchains         name
## Class:         list    character</code></pre>
<p>The first class has been designed to handle homogeneous Markov chain processes, while the latter (which is itself a list of <code>markovchain</code> objects) has been designed to handle non-homogeneous Markov chains processes.</p>
<p>Any element of <code>markovchain</code> class is comprised by following slots:</p>
<ol style="list-style-type: decimal">
<li>
<code>states</code>: a character vector, listing the states for which transition probabilities are defined.</li>
<li>
<code>byrow</code>: a logical element, indicating whether transition probabilities are shown by row or by column.</li>
<li>
<code>transitionMatrix</code>: the probabilities of the transition matrix.</li>
<li>
<code>name</code>: optional character element to name the DTMC.</li>
</ol>
<p>The <code>markovchainList</code> objects are defined by following slots:</p>
<ol style="list-style-type: decimal">
<li>
<code>markovchains</code>: a list of <code>markovchain</code> objects.</li>
<li>
<code>name</code>: optional character element to name the DTMC.</li>
</ol>
<p>The <code>markovchain</code> objects can be created either in a long way, as the following code shows</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">weatherStates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sunny"</span>, <span class="st">"cloudy"</span>, <span class="st">"rain"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">byRow &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">weatherMatrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.70</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                       <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                       <span class="fl">0.2</span>, <span class="fl">0.45</span>, <span class="fl">0.35</span>), <span class="dt">byrow =</span> byRow, <span class="dt">nrow =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                     <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(weatherStates, weatherStates))</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">mcWeather &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> weatherStates, <span class="dt">byrow =</span> byRow, </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">               <span class="dt">transitionMatrix =</span> weatherMatrix, <span class="dt">name =</span> <span class="st">"Weather"</span>)</a></code></pre></div>
<p>or in a shorter way, displayed below</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">mcWeather &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sunny"</span>, <span class="st">"cloudy"</span>, <span class="st">"rain"</span>),</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                 <span class="dt">transitionMatrix =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.70</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                       <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                       <span class="fl">0.2</span>, <span class="fl">0.45</span>, <span class="fl">0.35</span>), <span class="dt">byrow =</span> byRow, <span class="dt">nrow =</span> <span class="dv">3</span>), </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                 <span class="dt">name =</span> <span class="st">"Weather"</span>)</a></code></pre></div>
<p>When <code>new("markovchain")</code> is called alone, a default Markov chain is created.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">defaultMc &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>)</a></code></pre></div>
<p>The quicker way to create <code>markovchain</code> objects is made possible thanks to the implemented <code>initialize</code> S4 method that checks that:</p>
<ul>
<li>the <code>transitionMatrix</code> to be a transition matrix, i.e., all entries to be probabilities and either all rows or all columns to sum up to one.</li>
<li>the columns and rows names of <code>transitionMatrix</code> to be defined and to coincide with <code>states</code> vector slot.</li>
</ul>
<p>The <code>markovchain</code> objects can be collected in a list within <code>markovchainList</code> S4 objects as following example shows.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">mcList &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchainList"</span>, <span class="dt">markovchains =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(mcWeather, defaultMc), </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">                  <span class="dt">name =</span> <span class="st">"A list of Markov chains"</span>)</a></code></pre></div>
</div>
<div id="handling-markovchain-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#handling-markovchain-objects" class="anchor"></a>Handling markovchain objects</h2>
<p>Table @ref(tab:methodsToHandleMc) lists which methods handle and manipulate <code>markovchain</code> objects.</p>

<p>The examples that follow shows how operations on <code>markovchain</code> objects can be easily performed. For example, using the previously defined matrix we can find what is the probability distribution of expected weather states in two and seven days, given the actual state to be cloudy.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">initialState &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">after2Days &lt;-<span class="st"> </span>initialState <span class="op">*</span><span class="st"> </span>(mcWeather <span class="op">*</span><span class="st"> </span>mcWeather)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">after7Days &lt;-<span class="st"> </span>initialState <span class="op">*</span><span class="st"> </span>(mcWeather <span class="op">^</span><span class="st"> </span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">after2Days</a></code></pre></div>
<pre><code>##      sunny cloudy  rain
## [1,]  0.39  0.355 0.255</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(after7Days, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##      sunny cloudy  rain
## [1,] 0.462  0.319 0.219</code></pre>
<p>A similar answer could have been obtained defining the vector of probabilities as a column vector. A column - defined probability matrix could be set up either creating a new matrix or transposing an existing <code>markovchain</code> object thanks to the <code>t</code> method.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">initialState &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">after2Days &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(mcWeather) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(mcWeather)) <span class="op">*</span><span class="st"> </span>initialState</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">after7Days &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(mcWeather) <span class="op">^</span><span class="st"> </span><span class="dv">7</span>) <span class="op">*</span><span class="st"> </span>initialState</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">after2Days</a></code></pre></div>
<pre><code>##         [,1]
## sunny  0.390
## cloudy 0.355
## rain   0.255</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(after7Days, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##         [,1]
## sunny  0.462
## cloudy 0.319
## rain   0.219</code></pre>
<p>The initial state vector previously shown can not necessarily be a probability vector, as the code that follows shows:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">fvals&lt;-<span class="cf">function</span>(mchain,initialstate,n) {</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  out&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>()</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(initialstate)&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(mchain)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>n)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  {</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">    iteration&lt;-initialstate<span class="op">*</span>mchain<span class="op">^</span>(i)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    out&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(out,iteration)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">  out&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(out, <span class="dt">i=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,n))</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  out&lt;-out[,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">4</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)]</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="kw">fvals</span>(<span class="dt">mchain=</span>mcWeather,<span class="dt">initialstate=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">90</span>,<span class="dv">5</span>,<span class="dv">5</span>),<span class="dt">n=</span><span class="dv">4</span>)</a></code></pre></div>
<pre><code>##   i    sunny   cloudy     rain
## 1 0 90.00000  5.00000  5.00000
## 2 1 65.50000 22.25000 12.25000
## 3 2 54.97500 27.51250 17.51250
## 4 3 50.23875 29.88063 19.88062
## 5 4 48.10744 30.94628 20.94628</code></pre>
<p>Basic methods have been defined for <code>markovchain</code> objects to quickly get states and transition matrix dimension.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/states.html">states</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## [1] "sunny"  "cloudy" "rain"</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## [1] "sunny"  "cloudy" "rain"</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Methods are available to set and get the name of <code>markovchain</code> object.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="../reference/getName.html">name</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## [1] "Weather"</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="../reference/getName.html">name</a></span>(mcWeather) &lt;-<span class="st"> "New Name"</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="kw"><a href="../reference/getName.html">name</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## [1] "New Name"</code></pre>
<p>Also it is possible to alphabetically sort the transition matrix:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">markovchain<span class="op">:::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sort">sort</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## New Name 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  cloudy, rain, sunny 
##  The transition matrix  (by rows)  is defined as follows: 
##        cloudy rain sunny
## cloudy   0.40 0.30   0.3
## rain     0.45 0.35   0.2
## sunny    0.20 0.10   0.7</code></pre>
<p>A direct access to transition probabilities is provided both by <code>transitionProbability</code> method and <code>"["</code> method.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="../reference/transitionProbability.html">transitionProbability</a></span>(mcWeather, <span class="st">"cloudy"</span>, <span class="st">"rain"</span>)</a></code></pre></div>
<pre><code>## [1] 0.3</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">mcWeather[<span class="dv">2</span>,<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 0.3</code></pre>
<p>The transition matrix of a <code>markovchain</code> object can be displayed using <code>print</code> or <code>show</code> methods (the latter being less verbose). Similarly, the underlying transition probability diagram can be plotted by the use of <code>plot</code> method (as shown in Figure @ref(fig:mcPlot)) which is based on  package <span class="citation">(Csardi and Nepusz 2006)</span>. <code>plot</code> method for <code>markovchain</code> objects is a wrapper of <code>plot.igraph</code> for <code>igraph</code> S4 objects defined within the  package. Additional parameters can be passed to <code>plot</code> function to control the network graph layout. There are also  and  ways available for plotting as shown in Figure @ref(fig:mcPlotdiagram). The <code>plot</code> function also uses <code>communicatingClasses</code> function to separate out states of different communicating classes. All states that belong to one class have same colour.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(mcWeather)</a></code></pre></div>
<pre><code>##        sunny cloudy rain
## sunny    0.7   0.20 0.10
## cloudy   0.3   0.40 0.30
## rain     0.2   0.45 0.35</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">show</span>(mcWeather)</a></code></pre></div>
<pre><code>## New Name 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  sunny, cloudy, rain 
##  The transition matrix  (by rows)  is defined as follows: 
##        sunny cloudy rain
## sunny    0.7   0.20 0.10
## cloudy   0.3   0.40 0.30
## rain     0.2   0.45 0.35</code></pre>
<pre><code>## 
## Attaching package: 'igraph'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     union</code></pre>
<div class="figure">
<img src="an_introduction_to_markovchain_package_files/figure-html/mcPlot-1.png" alt="Weather example. Markov chain plot" width="70%"><p class="caption">
Weather example. Markov chain plot
</p>
</div>
<div class="figure">
<img src="an_introduction_to_markovchain_package_files/figure-html/mcPlotdiagram-1.png" alt="Weather example. Markov chain plot with diagram" width="70%"><p class="caption">
Weather example. Markov chain plot with diagram
</p>
</div>
<p>If one would like to use the  package <span class="citation">(Adamopoulou 2018)</span> to plot the transition matric, the following code shows how to do:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"MmgraphR"</span>)</a></code></pre></div>
<pre><code>## Loading required package: TraMineR</code></pre>
<pre><code>## 
## TraMineR stable version 2.0-12 (Built: 2019-07-20)</code></pre>
<pre><code>## Website: http://traminer.unige.ch</code></pre>
<pre><code>## Please type 'citation("TraMineR")' for citation information.</code></pre>
<pre><code>## Loading required package: colorspace</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">stochastic_matrix_to_plot &lt;-<span class="st"> </span><span class="kw">as</span>(mcWeather,<span class="st">"matrix"</span>)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/MmgraphR/topics/trmatplot">trmatplot</a></span>(stochastic_matrix_to_plot,<span class="dt">main=</span><span class="st">"Weather MC plot using MmgraphR"</span>)</a></code></pre></div>
<p><img src="an_introduction_to_markovchain_package_files/figure-html/MmgraphR_plot-1.png" width="70%"></p>
<p>Import and export from some specific classes is possible, as shown in Figure @ref(fig:fromAndTo) and in the following code.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">mcDf &lt;-<span class="st"> </span><span class="kw">as</span>(mcWeather, <span class="st">"data.frame"</span>)</a>
<a class="sourceLine" id="cb48-2" data-line-number="2">mcNew &lt;-<span class="st"> </span><span class="kw">as</span>(mcDf, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">mcDf</a></code></pre></div>
<pre><code>##       t0     t1 prob
## 1  sunny  sunny 0.70
## 2  sunny cloudy 0.20
## 3  sunny   rain 0.10
## 4 cloudy  sunny 0.30
## 5 cloudy cloudy 0.40
## 6 cloudy   rain 0.30
## 7   rain  sunny 0.20
## 8   rain cloudy 0.45
## 9   rain   rain 0.35</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">mcIgraph &lt;-<span class="st"> </span><span class="kw">as</span>(mcWeather, <span class="st">"igraph"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(msm)</a></code></pre></div>
<pre><code>## Loading required package: msm</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">Q &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span> ( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.166</span>, <span class="dv">0</span>, <span class="fl">0.166</span>, <span class="fl">0.166</span>),</a>
<a class="sourceLine" id="cb53-3" data-line-number="3">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb53-4" data-line-number="4">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) )</a>
<a class="sourceLine" id="cb53-5" data-line-number="5">cavmsm &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/msm/topics/msm">msm</a></span>(state <span class="op">~</span><span class="st"> </span>years, <span class="dt">subject =</span> PTNUM, <span class="dt">data =</span> cav, <span class="dt">qmatrix =</span> Q, <span class="dt">death =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb53-6" data-line-number="6">msmMc &lt;-<span class="st"> </span><span class="kw">as</span>(cavmsm, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb53-7" data-line-number="7">msmMc</a></code></pre></div>
<pre><code>## Unnamed Markov chain 
##  A  4 - dimensional discrete Markov Chain defined by the following states: 
##  State 1, State 2, State 3, State 4 
##  The transition matrix  (by rows)  is defined as follows: 
##             State 1    State 2    State 3    State 4
## State 1 0.853958721 0.08836953 0.01475543 0.04291632
## State 2 0.155576908 0.56663284 0.20599563 0.07179462
## State 3 0.009903994 0.07853691 0.65965727 0.25190183
## State 4 0.000000000 0.00000000 0.00000000 1.00000000</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(etm)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(sir.cont)</a>
<a class="sourceLine" id="cb55-3" data-line-number="3">sir.cont &lt;-<span class="st"> </span>sir.cont[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(sir.cont<span class="op">$</span>id, sir.cont<span class="op">$</span>time), ]</a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(sir.cont)) {</a>
<a class="sourceLine" id="cb55-5" data-line-number="5">  <span class="cf">if</span> (sir.cont<span class="op">$</span>id[i]<span class="op">==</span>sir.cont<span class="op">$</span>id[i<span class="dv">-1</span>]) {</a>
<a class="sourceLine" id="cb55-6" data-line-number="6">    <span class="cf">if</span> (sir.cont<span class="op">$</span>time[i]<span class="op">==</span>sir.cont<span class="op">$</span>time[i<span class="dv">-1</span>]) {</a>
<a class="sourceLine" id="cb55-7" data-line-number="7">      sir.cont<span class="op">$</span>time[i<span class="dv">-1</span>] &lt;-<span class="st"> </span>sir.cont<span class="op">$</span>time[i<span class="dv">-1</span>] <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb55-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb55-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb55-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb55-11" data-line-number="11">tra &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dt">ncol=</span><span class="dv">3</span>,<span class="dt">nrow=</span><span class="dv">3</span>,<span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb55-12" data-line-number="12">tra[<span class="dv">1</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb55-13" data-line-number="13">tra[<span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>)] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb55-14" data-line-number="14">tr.prob &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/etm/topics/etm">etm</a></span>(sir.cont, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>), tra, <span class="st">"cens"</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb55-15" data-line-number="15">tr.prob</a></code></pre></div>
<pre><code>## Multistate model with 2 transient state(s)
##  and 1 absorbing state(s)
## 
## Possible transitions:
##  from to
##     0  1
##     0  2
##     1  0
##     1  2
## 
## Estimate of P(1, 183)
##   0 1 2
## 0 0 0 1
## 1 0 0 1
## 2 0 0 1</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">etm2mc&lt;-<span class="kw">as</span>(tr.prob, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">etm2mc</a></code></pre></div>
<pre><code>## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  0, 1, 2 
##  The transition matrix  (by rows)  is defined as follows: 
##           0         1         2
## 0 0.0000000 0.5000000 0.5000000
## 1 0.5000000 0.0000000 0.5000000
## 2 0.3333333 0.3333333 0.3333333</code></pre>
<div class="figure">
<img src="an_introduction_to_markovchain_package_files/figure-html/fromAndTo-1.png" alt="The markovchain methods for import and export" width="70%"><p class="caption">
The markovchain methods for import and export
</p>
</div>
<p>Coerce from <code>matrix</code> method, as the code below shows, represents another approach to create a <code>markovchain</code> method starting from a given squared probability matrix.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">myMatr&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(.<span class="dv">1</span>,.<span class="dv">8</span>,.<span class="dv">1</span>,.<span class="dv">2</span>,.<span class="dv">6</span>,.<span class="dv">2</span>,.<span class="dv">3</span>,.<span class="dv">4</span>,.<span class="dv">3</span>), <span class="dt">byrow=</span><span class="ot">TRUE</span>, <span class="dt">ncol=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb59-2" data-line-number="2">myMc&lt;-<span class="kw">as</span>(myMatr, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3">myMc</a></code></pre></div>
<pre><code>## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  s1, s2, s3 
##  The transition matrix  (by rows)  is defined as follows: 
##     s1  s2  s3
## s1 0.1 0.8 0.1
## s2 0.2 0.6 0.2
## s3 0.3 0.4 0.3</code></pre>
<p>Non-homogeneous Markov chains can be created with the aid of <code>markovchainList</code> object. The example that follows arises from health insurance, where the costs associated to patients in a Continuous Care Health Community (CCHC) are modelled by a non-homogeneous Markov Chain, since the transition probabilities change by year. Methods explicitly written for <code>markovchainList</code> objects are: <code>print</code>, <code>show</code>, <code>dim</code> and <code>[</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">stateNames =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"H"</span>, <span class="st">"I"</span>, <span class="st">"D"</span>)</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">Q0 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> stateNames, </a>
<a class="sourceLine" id="cb61-3" data-line-number="3">        <span class="dt">transitionMatrix =</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>,<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.3</span>,<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb61-4" data-line-number="4">        <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>), <span class="dt">name =</span> <span class="st">"state t0"</span>)</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">Q1 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> stateNames, </a>
<a class="sourceLine" id="cb61-6" data-line-number="6">        <span class="dt">transitionMatrix =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>,<span class="dv">0</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>,<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb61-7" data-line-number="7">        <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>), <span class="dt">name =</span> <span class="st">"state t1"</span>)</a>
<a class="sourceLine" id="cb61-8" data-line-number="8">Q2 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> stateNames, </a>
<a class="sourceLine" id="cb61-9" data-line-number="9">        <span class="dt">transitionMatrix =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>,<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>,<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb61-10" data-line-number="10">        <span class="dt">byrow =</span> <span class="ot">TRUE</span>,<span class="dt">nrow =</span> <span class="dv">3</span>), <span class="dt">name =</span> <span class="st">"state t2"</span>)</a>
<a class="sourceLine" id="cb61-11" data-line-number="11">Q3 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> stateNames, </a>
<a class="sourceLine" id="cb61-12" data-line-number="12">          <span class="dt">transitionMatrix =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb61-13" data-line-number="13">        <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">nrow =</span> <span class="dv">3</span>), <span class="dt">name =</span> <span class="st">"state t3"</span>)</a>
<a class="sourceLine" id="cb61-14" data-line-number="14">mcCCRC &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchainList"</span>,<span class="dt">markovchains =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(Q0,Q1,Q2,Q3), </a>
<a class="sourceLine" id="cb61-15" data-line-number="15">      <span class="dt">name =</span> <span class="st">"Continuous Care Health Community"</span>)</a>
<a class="sourceLine" id="cb61-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(mcCCRC)</a></code></pre></div>
<pre><code>## Continuous Care Health Community  list of Markov chain(s) 
## Markovchain  1 
## state t0 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  H, I, D 
##  The transition matrix  (by rows)  is defined as follows: 
##     H   I   D
## H 0.7 0.2 0.1
## I 0.1 0.6 0.3
## D 0.0 0.0 1.0
## 
## Markovchain  2 
## state t1 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  H, I, D 
##  The transition matrix  (by rows)  is defined as follows: 
##     H   I   D
## H 0.5 0.3 0.2
## I 0.0 0.4 0.6
## D 0.0 0.0 1.0
## 
## Markovchain  3 
## state t2 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  H, I, D 
##  The transition matrix  (by rows)  is defined as follows: 
##     H   I   D
## H 0.3 0.2 0.5
## I 0.0 0.2 0.8
## D 0.0 0.0 1.0
## 
## Markovchain  4 
## state t3 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  H, I, D 
##  The transition matrix  (by rows)  is defined as follows: 
##   H I D
## H 0 0 1
## I 0 0 1
## D 0 0 1</code></pre>
<p>It is possible to perform direct access to <code>markovchainList</code> elements, as well as to determine the number of <code>markovchain</code> objects by which a <code>markovchainList</code> object is composed.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">mcCCRC[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## state t0 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  H, I, D 
##  The transition matrix  (by rows)  is defined as follows: 
##     H   I   D
## H 0.7 0.2 0.1
## I 0.1 0.6 0.3
## D 0.0 0.0 1.0</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(mcCCRC)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>The <code>markovchain</code> package contains some data found in the literature related to DTMC models (see Section @ref(sec:applications). Table @ref(tab:datasets) lists datasets and tables included within the current release of the package.</p>

<p>Finally, Table @ref(tab:demos) lists the demos included in the demo directory of the package.</p>

</div>
</div>
<div id="sec:probability" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:probability" class="anchor"></a>Probability with markovchain objects</h1>
<p>The  package contains functions to analyse DTMC from a probabilistic perspective. For example, the package provides methods to find stationary distributions and identifying absorbing and transient states. Many of these methods come from  listings that have been ported into . For a full description of the underlying theory and algorithm the interested reader can overview the original  listings,  and .</p>
<p>Table @ref(tab:methodsToStats) shows methods that can be applied on <code>markovchain</code> objects to perform probabilistic analysis.</p>

<div id="conditional-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#conditional-distributions" class="anchor"></a>Conditional distributions</h2>
<p>The conditional distribution of weather states, given that current day’s weather is sunny, is given by following code.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw"><a href="../reference/conditionalDistribution.html">conditionalDistribution</a></span>(mcWeather, <span class="st">"sunny"</span>)</a></code></pre></div>
<pre><code>##  sunny cloudy   rain 
##    0.7    0.2    0.1</code></pre>
</div>
<div id="stationary-states" class="section level2">
<h2 class="hasAnchor">
<a href="#stationary-states" class="anchor"></a>Stationary states</h2>
<p>A stationary (steady state, or equilibrium) vector is a probability vector such that Equation  holds</p>

<p>Steady states are associated to <span class="math inline">\(P\)</span> eigenvalues equal to one. Therefore the steady states vector can be identified by the following:</p>
<ol style="list-style-type: decimal">
<li>decompose the transition matrix in eigenvalues and eigenvectors;</li>
<li>consider only eigenvectors corresponding to eigenvalues equal to one;</li>
<li>normalize such eigenvalues so that the sum of their components is one.</li>
</ol>
<p>Numeric issue (negative values) can arise when the Markov Chain contains more closed classes. If negative values are found in the initial solution, the above described algorithm is performed on the submatrix corresponding to recurrent P classes. Another vignette in the package focuses on this issue.</p>
<p>The result is returned in matrix form.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(mcWeather)</a></code></pre></div>
<pre><code>##          sunny    cloudy      rain
## [1,] 0.4636364 0.3181818 0.2181818</code></pre>
<p>It is possible for a Markov chain to have more than one stationary distribution, as the gambler ruin example shows.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">gamblerRuinMarkovChain &lt;-<span class="st"> </span><span class="cf">function</span>(moneyMax, <span class="dt">prob =</span> <span class="fl">0.5</span>) {</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(matlab)</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">  matr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(moneyMax <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb71-4" data-line-number="4">  states &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> moneyMax, <span class="dt">by =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb71-5" data-line-number="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(matr) =<span class="st"> </span>states; <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(matr) =<span class="st"> </span>states</a>
<a class="sourceLine" id="cb71-6" data-line-number="6">  matr[<span class="dv">1</span>,<span class="dv">1</span>] =<span class="st"> </span><span class="dv">1</span>; matr[moneyMax <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,moneyMax <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb71-7" data-line-number="7">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>moneyMax)</a>
<a class="sourceLine" id="cb71-8" data-line-number="8">  { matr[i,i<span class="dv">-1</span>] =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prob; matr[i, i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>] =<span class="st"> </span>prob   }</a>
<a class="sourceLine" id="cb71-9" data-line-number="9">  out &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>,  </a>
<a class="sourceLine" id="cb71-10" data-line-number="10">           <span class="dt">transitionMatrix =</span> matr, </a>
<a class="sourceLine" id="cb71-11" data-line-number="11">           <span class="dt">name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Gambler ruin"</span>, moneyMax, <span class="st">"dim"</span>, <span class="dt">sep =</span> <span class="st">" "</span>)</a>
<a class="sourceLine" id="cb71-12" data-line-number="12">           )</a>
<a class="sourceLine" id="cb71-13" data-line-number="13">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb71-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb71-15" data-line-number="15"></a>
<a class="sourceLine" id="cb71-16" data-line-number="16">mcGR4 &lt;-<span class="st"> </span><span class="kw">gamblerRuinMarkovChain</span>(<span class="dt">moneyMax =</span> <span class="dv">4</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## Loading required package: matlab</code></pre>
<pre><code>## 
## Attaching package: 'matlab'</code></pre>
<pre><code>## The following object is masked from 'package:stats':
## 
##     reshape</code></pre>
<pre><code>## The following objects are masked from 'package:utils':
## 
##     find, fix</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     sum</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(mcGR4)</a></code></pre></div>
<pre><code>##      0 1 2 3 4
## [1,] 0 0 0 0 1
## [2,] 1 0 0 0 0</code></pre>
</div>
<div id="classification-of-states" class="section level2">
<h2 class="hasAnchor">
<a href="#classification-of-states" class="anchor"></a>Classification of states</h2>
<p>Absorbing states are determined by means of <code>absorbingStates</code> method.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw"><a href="../reference/absorbingStates.html">absorbingStates</a></span>(mcGR4)</a></code></pre></div>
<pre><code>## [1] "0" "4"</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw"><a href="../reference/absorbingStates.html">absorbingStates</a></span>(mcWeather)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>The key function used within  (and ’s derived functions) is <code>.commclassKernel</code>, that is called below.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">.commClassesKernel &lt;-<span class="st"> </span><span class="cf">function</span>(P){</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">  m &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(P)</a>
<a class="sourceLine" id="cb83-3" data-line-number="3">    stateNames &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(P)</a>
<a class="sourceLine" id="cb83-4" data-line-number="4">    T &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(m) </a>
<a class="sourceLine" id="cb83-5" data-line-number="5">    i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb83-6" data-line-number="6">    <span class="cf">while</span> (i <span class="op">&lt;=</span><span class="st"> </span>m) { </a>
<a class="sourceLine" id="cb83-7" data-line-number="7">        a &lt;-<span class="st"> </span>i </a>
<a class="sourceLine" id="cb83-8" data-line-number="8">        b &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">1</span>,m)</a>
<a class="sourceLine" id="cb83-9" data-line-number="9">        b[<span class="dv">1</span>,i] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb83-10" data-line-number="10">        old &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb83-11" data-line-number="11">        new &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb83-12" data-line-number="12">        <span class="cf">while</span> (old <span class="op">!=</span><span class="st"> </span>new) {</a>
<a class="sourceLine" id="cb83-13" data-line-number="13">            old &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/find">find</a></span>(b <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb83-14" data-line-number="14">            n &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/size">size</a></span>(a)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb83-15" data-line-number="15">            matr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(P[a,]), <span class="dt">ncol =</span> m, </a>
<a class="sourceLine" id="cb83-16" data-line-number="16">                     <span class="dt">nrow =</span> n)</a>
<a class="sourceLine" id="cb83-17" data-line-number="17">            c &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colSums</a></span>(matr)</a>
<a class="sourceLine" id="cb83-18" data-line-number="18">            d &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/find">find</a></span>(c)</a>
<a class="sourceLine" id="cb83-19" data-line-number="19">            n &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/size">size</a></span>(d)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb83-20" data-line-number="20">            b[<span class="dv">1</span>,d] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">ones</a></span>(<span class="dv">1</span>,n)</a>
<a class="sourceLine" id="cb83-21" data-line-number="21">            new &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/find">find</a></span>(b<span class="op">&gt;</span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb83-22" data-line-number="22">            a &lt;-<span class="st"> </span>d</a>
<a class="sourceLine" id="cb83-23" data-line-number="23">        }</a>
<a class="sourceLine" id="cb83-24" data-line-number="24">        T[i,] &lt;-<span class="st"> </span>b</a>
<a class="sourceLine" id="cb83-25" data-line-number="25">        i &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span> }</a>
<a class="sourceLine" id="cb83-26" data-line-number="26">    F &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(T)  </a>
<a class="sourceLine" id="cb83-27" data-line-number="27">    C &lt;-<span class="st"> </span>(T <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)<span class="op">&amp;</span>(F <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb83-28" data-line-number="28">    v &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(C) <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(T), <span class="dv">2</span>, sum) <span class="op">==</span><span class="st"> </span>m)</a>
<a class="sourceLine" id="cb83-29" data-line-number="29">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(C) &lt;-<span class="st"> </span>stateNames</a>
<a class="sourceLine" id="cb83-30" data-line-number="30">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(C) &lt;-<span class="st"> </span>stateNames</a>
<a class="sourceLine" id="cb83-31" data-line-number="31">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(v) &lt;-<span class="st"> </span>stateNames</a>
<a class="sourceLine" id="cb83-32" data-line-number="32">    out &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">C =</span> C, <span class="dt">v =</span> v)</a>
<a class="sourceLine" id="cb83-33" data-line-number="33">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb83-34" data-line-number="34">}</a></code></pre></div>
<p>The <code>.commclassKernel</code> function gets a transition matrix of dimension <span class="math inline">\(n\)</span> and return a list of two items:</p>
<ol style="list-style-type: decimal">
<li>
<code>C</code>, an adjacency matrix showing for each state <span class="math inline">\(s_{j}\)</span> (in the row) which states lie in the same communicating class of <span class="math inline">\(s_{j}\)</span> (flagged with 1).</li>
<li>
<code>v</code>, a binary vector indicating whether the state <span class="math inline">\(s_{j}\)</span> is transient (0) or not (1).</li>
</ol>
<p>These functions are used by two other internal functions on which the <code>summary</code> method for <code>markovchain</code> objects works.</p>
<p>The example matrix used in  well exemplifies the purpose of the function.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">P &lt;-<span class="st"> </span>matlab<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">P[<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">3</span>)] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>;</a>
<a class="sourceLine" id="cb84-3" data-line-number="3">P[<span class="dv">2</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>; P[<span class="dv">2</span>,<span class="dv">7</span>] &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span>;</a>
<a class="sourceLine" id="cb84-4" data-line-number="4">P[<span class="dv">3</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb84-5" data-line-number="5">P[<span class="dv">4</span>, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb84-6" data-line-number="6">P[<span class="dv">5</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">9</span>)] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>;</a>
<a class="sourceLine" id="cb84-7" data-line-number="7">P[<span class="dv">6</span>, <span class="dv">6</span>] &lt;-<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb84-8" data-line-number="8">P[<span class="dv">7</span>, <span class="dv">7</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">4</span>; P[<span class="dv">7</span>,<span class="dv">9</span>] &lt;-<span class="st"> </span><span class="dv">3</span><span class="op">/</span><span class="dv">4</span>;</a>
<a class="sourceLine" id="cb84-9" data-line-number="9">P[<span class="dv">8</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">10</span>)] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">4</span>;</a>
<a class="sourceLine" id="cb84-10" data-line-number="10">P[<span class="dv">9</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span>;</a>
<a class="sourceLine" id="cb84-11" data-line-number="11">P[<span class="dv">10</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>)] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>;</a>
<a class="sourceLine" id="cb84-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(P) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>] </a>
<a class="sourceLine" id="cb84-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(P) &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb84-14" data-line-number="14">probMc &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> P, </a>
<a class="sourceLine" id="cb84-15" data-line-number="15">              <span class="dt">name =</span> <span class="st">"Probability MC"</span>)</a>
<a class="sourceLine" id="cb84-16" data-line-number="16"><span class="kw">.commClassesKernel</span>(P)</a></code></pre></div>
<pre><code>## $C
##       a     b     c     d     e     f     g     h     i     j
## a  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## b FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE
## c  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## d FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE
## e FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE
## f FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## g FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE
## h FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## i FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE
## j FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE
## 
## $v
##     a     b     c     d     e     f     g     h     i     j 
##  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE FALSE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(probMc)</a></code></pre></div>
<pre><code>## Probability MC  Markov chain that is composed by: 
## Closed classes: 
## a c 
## b g i 
## f 
## Recurrent classes: 
## {a,c},{b,g,i},{f}
## Transient classes: 
## {d,e},{h},{j}
## The Markov chain is not irreducible 
## The absorbing states are: f</code></pre>
<p>All states that pertain to a transient class are named “transient” and a specific method has been written to elicit them.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw"><a href="../reference/absorbingStates.html">transientStates</a></span>(probMc)</a></code></pre></div>
<pre><code>## [1] "d" "e" "h" "j"</code></pre>
<p>Listings from  have been adapted into <code>canonicForm</code> method that turns a Markov chain into canonic form.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">probMcCanonic &lt;-<span class="st"> </span><span class="kw"><a href="../reference/absorbingStates.html">canonicForm</a></span>(probMc)</a>
<a class="sourceLine" id="cb90-2" data-line-number="2">probMc</a></code></pre></div>
<pre><code>## Probability MC 
##  A  10 - dimensional discrete Markov Chain defined by the following states: 
##  a, b, c, d, e, f, g, h, i, j 
##  The transition matrix  (by rows)  is defined as follows: 
##     a         b    c         d         e f         g    h         i
## a 0.5 0.0000000 0.50 0.0000000 0.0000000 0 0.0000000 0.00 0.0000000
## b 0.0 0.3333333 0.00 0.0000000 0.0000000 0 0.6666667 0.00 0.0000000
## c 1.0 0.0000000 0.00 0.0000000 0.0000000 0 0.0000000 0.00 0.0000000
## d 0.0 0.0000000 0.00 0.0000000 1.0000000 0 0.0000000 0.00 0.0000000
## e 0.0 0.0000000 0.00 0.3333333 0.3333333 0 0.0000000 0.00 0.3333333
## f 0.0 0.0000000 0.00 0.0000000 0.0000000 1 0.0000000 0.00 0.0000000
## g 0.0 0.0000000 0.00 0.0000000 0.0000000 0 0.2500000 0.00 0.7500000
## h 0.0 0.0000000 0.25 0.2500000 0.0000000 0 0.0000000 0.25 0.0000000
## i 0.0 1.0000000 0.00 0.0000000 0.0000000 0 0.0000000 0.00 0.0000000
## j 0.0 0.3333333 0.00 0.0000000 0.3333333 0 0.0000000 0.00 0.0000000
##           j
## a 0.0000000
## b 0.0000000
## c 0.0000000
## d 0.0000000
## e 0.0000000
## f 0.0000000
## g 0.0000000
## h 0.2500000
## i 0.0000000
## j 0.3333333</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">probMcCanonic</a></code></pre></div>
<pre><code>## Probability MC 
##  A  10 - dimensional discrete Markov Chain defined by the following states: 
##  a, c, b, g, i, f, d, e, h, j 
##  The transition matrix  (by rows)  is defined as follows: 
##     a    c         b         g         i f         d         e    h
## a 0.5 0.50 0.0000000 0.0000000 0.0000000 0 0.0000000 0.0000000 0.00
## c 1.0 0.00 0.0000000 0.0000000 0.0000000 0 0.0000000 0.0000000 0.00
## b 0.0 0.00 0.3333333 0.6666667 0.0000000 0 0.0000000 0.0000000 0.00
## g 0.0 0.00 0.0000000 0.2500000 0.7500000 0 0.0000000 0.0000000 0.00
## i 0.0 0.00 1.0000000 0.0000000 0.0000000 0 0.0000000 0.0000000 0.00
## f 0.0 0.00 0.0000000 0.0000000 0.0000000 1 0.0000000 0.0000000 0.00
## d 0.0 0.00 0.0000000 0.0000000 0.0000000 0 0.0000000 1.0000000 0.00
## e 0.0 0.00 0.0000000 0.0000000 0.3333333 0 0.3333333 0.3333333 0.00
## h 0.0 0.25 0.0000000 0.0000000 0.0000000 0 0.2500000 0.0000000 0.25
## j 0.0 0.00 0.3333333 0.0000000 0.0000000 0 0.0000000 0.3333333 0.00
##           j
## a 0.0000000
## c 0.0000000
## b 0.0000000
## g 0.0000000
## i 0.0000000
## f 0.0000000
## d 0.0000000
## e 0.0000000
## h 0.2500000
## j 0.3333333</code></pre>
<p>The function <code>is.accessible</code> permits to investigate whether a state <span class="math inline">\(s_{j}\)</span> is accessible from state <span class="math inline">\(s_i\)</span>, that is whether the probability to eventually reach <span class="math inline">\(s_j\)</span> starting from <span class="math inline">\(s_{i}\)</span> is greater than zero.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw"><a href="../reference/is.accessible.html">is.accessible</a></span>(<span class="dt">object =</span> probMc, <span class="dt">from =</span> <span class="st">"a"</span>, <span class="dt">to =</span> <span class="st">"c"</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw"><a href="../reference/is.accessible.html">is.accessible</a></span>(<span class="dt">object =</span> probMc, <span class="dt">from =</span> <span class="st">"g"</span>, <span class="dt">to =</span> <span class="st">"c"</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>In Section @ref(sec:properties) we observed that, if a DTMC is irreducible, all its states share the same periodicity. Then, the <code>period</code> function returns the periodicity of the DTMC, provided that it is irreducible. The example that follows shows how to find if a DTMC is reducible or irreducible by means of the function <code>is.irreducible</code> and, in the latter case, the method <code>period</code> is used to compute the periodicity of the chain.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">E &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">E[<span class="dv">1</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3">E[<span class="dv">2</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>; E[<span class="dv">2</span>, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb98-4" data-line-number="4">E[<span class="dv">3</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">4</span>; E[<span class="dv">3</span>, <span class="dv">4</span>] &lt;-<span class="st"> </span><span class="dv">3</span><span class="op">/</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5">E[<span class="dv">4</span>, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6"></a>
<a class="sourceLine" id="cb98-7" data-line-number="7">mcE &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>), </a>
<a class="sourceLine" id="cb98-8" data-line-number="8">        <span class="dt">transitionMatrix =</span> E, </a>
<a class="sourceLine" id="cb98-9" data-line-number="9">        <span class="dt">name =</span> <span class="st">"E"</span>)</a>
<a class="sourceLine" id="cb98-10" data-line-number="10"><span class="kw"><a href="../reference/is.irreducible.html">is.irreducible</a></span>(mcE)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw"><a href="../reference/absorbingStates.html">period</a></span>(mcE)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>The example Markov chain found in  web site  has been used, and is plotted in Figure @ref(fig:mcMathematics).</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(matlab)</a>
<a class="sourceLine" id="cb102-2" data-line-number="2">mathematicaMatr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb102-3" data-line-number="3">mathematicaMatr[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb102-4" data-line-number="4">mathematicaMatr[<span class="dv">2</span>,] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb102-5" data-line-number="5">mathematicaMatr[<span class="dv">3</span>,] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb102-6" data-line-number="6">mathematicaMatr[<span class="dv">4</span>,] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb102-7" data-line-number="7">mathematicaMatr[<span class="dv">5</span>,] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb102-8" data-line-number="8">statesNames &lt;-<span class="st"> </span>letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb102-9" data-line-number="9">mathematicaMc &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> mathematicaMatr,</a>
<a class="sourceLine" id="cb102-10" data-line-number="10">                   <span class="dt">name =</span> <span class="st">"Mathematica MC"</span>, <span class="dt">states =</span> statesNames)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="an_introduction_to_markovchain_package_files/figure-html/mcMathematics-1.png" alt="Mathematica 9 example. Markov chain plot." width="70%"><p class="caption">
Mathematica 9 example. Markov chain plot.
</p>
</div>
<pre><code>## Mathematica MC  Markov chain that is composed by: 
## Closed classes: 
## c d 
## e 
## Recurrent classes: 
## {c,d},{e}
## Transient classes: 
## {a,b}
## The Markov chain is not irreducible 
## The absorbing states are: e</code></pre>
</div>
<div id="first-passage-time-distributions-and-means" class="section level2">
<h2 class="hasAnchor">
<a href="#first-passage-time-distributions-and-means" class="anchor"></a>First passage time distributions and means</h2>
<p> provides code to compute first passage time (within <span class="math inline">\(1,2,\ldots, n\)</span> steps) given the initial state to be <span class="math inline">\(i\)</span>. The  listings translated into  on which the <code>firstPassage</code> function is based are:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">.firstpassageKernel &lt;-<span class="st"> </span><span class="cf">function</span>(P, i, n){</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">  G &lt;-<span class="st"> </span>P</a>
<a class="sourceLine" id="cb104-3" data-line-number="3">  H &lt;-<span class="st"> </span>P[i,]</a>
<a class="sourceLine" id="cb104-4" data-line-number="4">  E &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/size">size</a></span>(P)[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb104-5" data-line-number="5">  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb104-6" data-line-number="6">    G &lt;-<span class="st"> </span>P <span class="op">%*%</span><span class="st"> </span>(G <span class="op">*</span><span class="st"> </span>E)</a>
<a class="sourceLine" id="cb104-7" data-line-number="7">    H &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(H, G[i,])</a>
<a class="sourceLine" id="cb104-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb104-9" data-line-number="9">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(H)</a>
<a class="sourceLine" id="cb104-10" data-line-number="10">}</a></code></pre></div>
<p>We conclude that the probability for the <em>first</em> rainy day to be the third one, given that the current state is sunny, is given by:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">firstPassagePdF &lt;-<span class="st"> </span><span class="kw"><a href="../reference/firstPassage.html">firstPassage</a></span>(<span class="dt">object =</span> mcWeather, <span class="dt">state =</span> <span class="st">"sunny"</span>, </a>
<a class="sourceLine" id="cb105-2" data-line-number="2">                                <span class="dt">n =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb105-3" data-line-number="3">firstPassagePdF[<span class="dv">3</span>, <span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 0.121</code></pre>
<!-- TONI (show before the PdF?) -->
<p>To compute the <em>mean</em> first passage times, i.e. the expected number of days before it rains given that today is sunny, we can use the <code>meanFirstPassageTime</code> function:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw"><a href="../reference/meanFirstPassageTime.html">meanFirstPassageTime</a></span>(mcWeather)</a></code></pre></div>
<pre><code>##           sunny   cloudy     rain
## sunny  0.000000 4.285714 6.666667
## cloudy 3.725490 0.000000 5.000000
## rain   4.117647 2.857143 0.000000</code></pre>
<p>indicating e.g. that the average numer of days of sun or cloud before rain is 6.67 if we start counting from a sunny day, and 5 if we start from a cloudy day. Note that we can also specify one or more destination states:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw"><a href="../reference/meanFirstPassageTime.html">meanFirstPassageTime</a></span>(mcWeather,<span class="st">"rain"</span>)</a></code></pre></div>
<pre><code>##    sunny   cloudy 
## 6.666667 5.000000</code></pre>
<p>The implementation follows the matrix solutions by <span class="citation">(Grinstead and Snell 2006)</span>. We can check the result by averaging the first passage probability density function:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">firstPassagePdF.long &lt;-<span class="st"> </span><span class="kw"><a href="../reference/firstPassage.html">firstPassage</a></span>(<span class="dt">object =</span> mcWeather, <span class="dt">state =</span> <span class="st">"sunny"</span>,  <span class="dt">n =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/sum">sum</a></span>(firstPassagePdF.long[,<span class="st">"rain"</span>] <span class="op">*</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span>)</a></code></pre></div>
<pre><code>## [1] 6.666664</code></pre>
</div>
<div id="committor-probability" class="section level2">
<h2 class="hasAnchor">
<a href="#committor-probability" class="anchor"></a>Committor probability</h2>
<p>The committor probability tells us the probability to reach a given state before another given. Suppose that we start in a cloudy day, the probabilities of experiencing a rainy day before a sunny one is 0.5:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw"><a href="../reference/committorAB.html">committorAB</a></span>(mcWeather,<span class="dv">3</span>,<span class="dv">1</span>)</a></code></pre></div>
<pre><code>##  sunny cloudy   rain 
##    0.0    0.5    1.0</code></pre>
</div>
<div id="hitting-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#hitting-probabilities" class="anchor"></a>Hitting probabilities</h2>
<p>Rewriting the system  as:</p>



<p>we end up having to solve the block systems:</p>

<p>Let us imagine the <span class="math inline">\(i\)</span> -th state has transition probabilities: <span class="math inline">\((0, \ldots, 0, \underset{i)}{1}, 0, \ldots, 0)\)</span>. Then that same row would turn into <span class="math inline">\((0,0, \ldots, 0)\)</span> for some block, thus obtaining a singular matrix. Another case which may give us problems could be: state <span class="math inline">\(i\)</span> has the following transition probabilities: <span class="math inline">\((0, \ldots, 0, \underset{j)}{1}, 0, \ldots, 0)\)</span> and the state <span class="math inline">\(j\)</span> has the following transition probabilities: <span class="math inline">\((0, \ldots, 0, \underset{i)}{1}, 0, \ldots, 0)\)</span>. Then when builing some blocks we will end up with rows:</p>

<p>which are linearly dependent. Our hypothesis is that if we treat the closed communicating classes differently, we <em>might</em> delete the linearity in the system. If we have a closed communicating class <span class="math inline">\(C_u\)</span>, then <span class="math inline">\(h_{i,j} = 1\)</span> for all <span class="math inline">\(i,j \in C_u\)</span> and <span class="math inline">\(h_{k,j} = 0\)</span> for all <span class="math inline">\(k\not\in C_u\)</span>. Then we can set <span class="math inline">\(X_u\)</span> appropriately and solve the other <span class="math inline">\(X_v\)</span> using those values.</p>
<p>The method in charge of that in <code>markovchain</code> package is <code>hittingProbabilities</code>, which receives a Markov chain and computes the matrix <span class="math inline">\((h_{ij})_{i,j = 1,\ldots, n}\)</span> where <span class="math inline">\(S = \{s_1, \ldots, s_n\}\)</span> is the set of all states of the chain.</p>
<p>For the following chain:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">M &lt;-<span class="st"> </span>matlab<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">5</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2">M[<span class="dv">1</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span>M[<span class="dv">5</span>,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3">M[<span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span>M[<span class="dv">2</span>,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4">M[<span class="dv">3</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span>M[<span class="dv">3</span>,<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb115-5" data-line-number="5">M[<span class="dv">4</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span>M[<span class="dv">4</span>,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"></a>
<a class="sourceLine" id="cb115-7" data-line-number="7">hittingTest &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> M)</a>
<a class="sourceLine" id="cb115-8" data-line-number="8"><span class="kw"><a href="../reference/hittingProbabilities.html">hittingProbabilities</a></span>(hittingTest)</a></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]      [,4] [,5]
## [1,]  1.0 0.000 0.000 0.0000000  0.0
## [2,]  0.8 0.375 0.500 0.3333333  0.2
## [3,]  0.6 0.750 0.375 0.6666667  0.4
## [4,]  0.4 0.500 0.250 0.1666667  0.6
## [5,]  0.0 0.000 0.000 0.0000000  1.0</code></pre>
<p>we want to compute the hitting probabilities. That can be done with:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw"><a href="../reference/hittingProbabilities.html">hittingProbabilities</a></span>(hittingTest)</a></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]      [,4] [,5]
## [1,]  1.0 0.000 0.000 0.0000000  0.0
## [2,]  0.8 0.375 0.500 0.3333333  0.2
## [3,]  0.6 0.750 0.375 0.6666667  0.4
## [4,]  0.4 0.500 0.250 0.1666667  0.6
## [5,]  0.0 0.000 0.000 0.0000000  1.0</code></pre>
<p>In the case of the <code>mcWeather</code> Markov chain we would obtain a matrix with all its elements set to <span class="math inline">\(1\)</span>. That makes sense (and is desirable) since if today is sunny, we expect it would be sunny again at certain point in the time, and the same with rainy weather (that way we assure good harvests):</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw"><a href="../reference/hittingProbabilities.html">hittingProbabilities</a></span>(mcWeather)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    1    1
## [2,]    1    1    1
## [3,]    1    1    1</code></pre>
</div>
</div>
<div id="sec:statistics" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:statistics" class="anchor"></a>Statistical analysis</h1>
<p>Table @ref(tab:funs4Stats) lists the functions and methods implemented within the package which help to fit, simulate and predict DTMC.</p>

<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<p>Simulating a random sequence from an underlying DTMC is quite easy thanks to the function <code>rmarkovchain</code>. The following code generates a year of weather states according to <code>mcWeather</code> underlying stochastic process.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">weathersOfDays &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n =</span> <span class="dv">365</span>, <span class="dt">object =</span> mcWeather, <span class="dt">t0 =</span> <span class="st">"sunny"</span>)</a>
<a class="sourceLine" id="cb121-2" data-line-number="2">weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>]</a></code></pre></div>
<pre><code>##  [1] "sunny"  "sunny"  "cloudy" "rain"   "cloudy" "cloudy" "sunny" 
##  [8] "cloudy" "rain"   "sunny"  "cloudy" "sunny"  "rain"   "sunny" 
## [15] "cloudy" "rain"   "rain"   "cloudy" "sunny"  "sunny"  "sunny" 
## [22] "sunny"  "sunny"  "sunny"  "cloudy" "cloudy" "sunny"  "sunny" 
## [29] "sunny"  "sunny"</code></pre>
<p>Similarly, it is possible to simulate one or more sequences from a non-homogeneous Markov chain, as the following code (applied on CCHC example) exemplifies.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">patientStates &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">object =</span> mcCCRC, <span class="dt">t0 =</span> <span class="st">"H"</span>, </a>
<a class="sourceLine" id="cb123-2" data-line-number="2">                              <span class="dt">include.t0 =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">patientStates[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</a></code></pre></div>
<pre><code>##    iteration values
## 1          1      H
## 2          1      H
## 3          1      D
## 4          1      D
## 5          1      D
## 6          2      H
## 7          2      H
## 8          2      I
## 9          2      D
## 10         2      D</code></pre>
<p>Two advance parameters are availabe to the <code>rmarkovchain</code> method which helps you decide which implementation to use. There are four options available : ,  in parallel,  and  in parallel. Two boolean parameters <code>useRcpp</code> and <code>parallel</code> will decide which implementation will be used. Default is  and  i.e.  implementation. The  implementation is generally faster than the <code>R</code> implementation. If you have multicore processors then you can take advantage of <code>parallel</code> parameter by setting it to <code>TRUE</code>. When both <code>Rcpp=TRUE</code> and <code>parallel=TRUE</code> the parallelization has been carried out using  package .</p>
</div>
<div id="estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation" class="anchor"></a>Estimation</h2>
<p>A time homogeneous Markov chain can be fit from given data. Four methods have been implemented within current version of  package: maximum likelihood, maximum likelihood with Laplace smoothing, Bootstrap approach, maximum a posteriori.</p>
<p>Equation  shows the maximum likelihood estimator (MLE) of the <span class="math inline">\(p_{ij}\)</span> entry, where the <span class="math inline">\(n_{ij}\)</span> element consists in the number sequences <span class="math inline">\(\left( X_{t}=s_{i}, X_{t+1}=s_{j}\right)\)</span> found in the sample, that is</p>

<p>Equation @ref(eq:SE) shows the <code>standardError</code> of the MLE .</p>

<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">weatherFittedMLE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data =</span> weathersOfDays, <span class="dt">method =</span> <span class="st">"mle"</span>,<span class="dt">name =</span> <span class="st">"Weather MLE"</span>)</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">weatherFittedMLE<span class="op">$</span>estimate</a></code></pre></div>
<pre><code>## Weather MLE 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  cloudy, rain, sunny 
##  The transition matrix  (by rows)  is defined as follows: 
##           cloudy      rain     sunny
## cloudy 0.3603604 0.3423423 0.2972973
## rain   0.4375000 0.3000000 0.2625000
## sunny  0.2080925 0.1040462 0.6878613</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">weatherFittedMLE<span class="op">$</span>standardError</a></code></pre></div>
<pre><code>##            cloudy       rain      sunny
## cloudy 0.05697798 0.05553526 0.05175282
## rain   0.07395100 0.06123724 0.05728220
## sunny  0.03468208 0.02452393 0.06305614</code></pre>
<p>The Laplace smoothing approach is a variation of the MLE, where the <span class="math inline">\(n_{ij}\)</span> is substituted by <span class="math inline">\(n_{ij}+\alpha\)</span> (see Equation ), being <span class="math inline">\(\alpha\)</span> an arbitrary positive stabilizing parameter.</p>

<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">weatherFittedLAPLACE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data =</span> weathersOfDays, </a>
<a class="sourceLine" id="cb129-2" data-line-number="2">                                    <span class="dt">method =</span> <span class="st">"laplace"</span>, <span class="dt">laplacian =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb129-3" data-line-number="3">                                    <span class="dt">name =</span> <span class="st">"Weather LAPLACE"</span>)</a>
<a class="sourceLine" id="cb129-4" data-line-number="4">weatherFittedLAPLACE<span class="op">$</span>estimate</a></code></pre></div>
<pre><code>## Weather LAPLACE 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  cloudy, rain, sunny 
##  The transition matrix  (by rows)  is defined as follows: 
##           cloudy      rain     sunny
## cloudy 0.3603531 0.3423399 0.2973070
## rain   0.4374610 0.3000125 0.2625266
## sunny  0.2081142 0.1040860 0.6877998</code></pre>
<p>(NOTE: The Confidence Interval option is enabled by default. Remove this option to fasten computations.) Both MLE and Laplace approach are based on the <code>createSequenceMatrix</code> functions that returns the raw counts transition matrix.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw"><a href="../reference/markovchainFit.html">createSequenceMatrix</a></span>(<span class="dt">stringchar =</span> weathersOfDays)</a></code></pre></div>
<pre><code>##        cloudy rain sunny
## cloudy     40   38    33
## rain       35   24    21
## sunny      36   18   119</code></pre>
<p><code>stringchar</code> could contain <code>NA</code> values, and the transitions containing <code>NA</code> would be ignored.</p>
<p>An issue occurs when the sample contains only one realization of a state (say <span class="math inline">\(X_{\beta}\)</span>) which is located at the end of the data sequence, since it yields to a row of zero (no sample to estimate the conditional distribution of the transition). In this case the estimated transition matrix is corrected assuming <span class="math inline">\(p_{\beta,j}=1/k\)</span>, being <span class="math inline">\(k\)</span> the possible states.</p>
<p>Create sequence matrix can also be used to obtain raw count transition matrices from a given <span class="math inline">\(n*2\)</span> matrix as the following example shows:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">myMatr&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>),<span class="dt">ncol=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="kw"><a href="../reference/markovchainFit.html">createSequenceMatrix</a></span>(<span class="dt">stringchar =</span> myMatr,<span class="dt">toRowProbs =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##           a         b
## a 0.6666667 0.3333333
## b 0.5000000 0.5000000</code></pre>
<p>A bootstrap estimation approach has been developed within the package in order to provide an indication of the variability of <span class="math inline">\({\hat p}_{ij}\)</span> estimates. The bootstrap approach implemented within the  package follows these steps:</p>
<ol style="list-style-type: decimal">
<li>bootstrap the data sequences following the conditional distributions of states estimated from the original one. The default bootstrap samples is 10, as specified in <code>nboot</code> parameter of <code>markovchainFit</code> function.</li>
<li>apply MLE estimation on bootstrapped data sequences that are saved in <code>bootStrapSamples</code> slot of the returned list.</li>
<li>the <span class="math inline">\({p^{BOOTSTRAP}}_{ij}\)</span> is the average of all <span class="math inline">\({p^{MLE}}_{ij}\)</span> across the <code>bootStrapSamples</code> list, normalized by row. A <code>standardError</code> of <span class="math inline">\(\hat{{p^{MLE}}_{ij}}\)</span> estimate is provided as well.</li>
</ol>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">weatherFittedBOOT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data =</span> weathersOfDays, </a>
<a class="sourceLine" id="cb135-2" data-line-number="2">                                    <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">nboot =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb135-3" data-line-number="3">weatherFittedBOOT<span class="op">$</span>estimate</a></code></pre></div>
<pre><code>## BootStrap Estimate 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  cloudy, rain, sunny 
##  The transition matrix  (by rows)  is defined as follows: 
##           cloudy      rain     sunny
## cloudy 0.3515103 0.3444988 0.3039908
## rain   0.4250353 0.3153023 0.2596624
## sunny  0.2163500 0.1016537 0.6819963</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">weatherFittedBOOT<span class="op">$</span>standardError</a></code></pre></div>
<pre><code>##             cloudy        rain       sunny
## cloudy 0.010680720 0.009802248 0.011498131
## rain   0.012587354 0.011195949 0.014145195
## sunny  0.007391729 0.006491509 0.008451873</code></pre>
<p>The bootstrapping process can be done in parallel thanks to  package . Parallelized implementation is definitively suggested when the data sample size or the required number of bootstrap runs is high.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">weatherFittedBOOTParallel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data =</span> weathersOfDays, </a>
<a class="sourceLine" id="cb139-2" data-line-number="2">                                    <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">nboot =</span> <span class="dv">200</span>, </a>
<a class="sourceLine" id="cb139-3" data-line-number="3">                                    <span class="dt">parallel =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb139-4" data-line-number="4">weatherFittedBOOTParallel<span class="op">$</span>estimate</a>
<a class="sourceLine" id="cb139-5" data-line-number="5">weatherFittedBOOTParallel<span class="op">$</span>standardError</a></code></pre></div>
<p>The parallel bootstrapping uses all the available cores on a machine by default. However, it is also possible to tune the number of threads used. Note that this should be done in R before calling the <code>markovchainFit</code> function. For example, the following code will set the number of threads to 4.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">RcppParallel<span class="op">::</span><span class="kw">setNumThreads</span>(<span class="dv">2</span>)</a></code></pre></div>
<p>For more details, please refer to  web site.</p>
<p>For all the fitting methods, the <code>logLikelihood</code>  denoted in Equation  is provided.</p>
<p><span class="math display">\[\begin{equation}
LLH = \sum_{i,j} n_{ij} * log (p_{ij})
\label{eq:LLH}
\end{equation}\]</span> where <span class="math inline">\(n_{ij}\)</span> is the entry of the frequency matrix and <span class="math inline">\(p_{ij}\)</span> is the entry of the transition probability matrix.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">weatherFittedMLE<span class="op">$</span>logLikelihood</a></code></pre></div>
<pre><code>## [1] -349.2767</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">weatherFittedBOOT<span class="op">$</span>logLikelihood</a></code></pre></div>
<pre><code>## [1] -349.3807</code></pre>
<p>Confidence matrices of estimated parameters (parametric for MLE, non - parametric for BootStrap) are available as well. The <code>confidenceInterval</code> is provided with the two matrices: <code>lowerEndpointMatrix</code> and <code>upperEndpointMatrix</code>. The confidence level (CL) is 0.95 by default and can be given as an argument of the function <code>markovchainFit</code>. This is used to obtain the standard score (z-score). From classical inference theory, if <span class="math inline">\(ci\)</span> is the level of confidence required assuming normal distribution the <span class="math inline">\(zscore(ci)\)</span> solves <span class="math inline">\(\Phi \left ( 1-\left(\frac{1-ci}{2}\right) \right )\)</span> Equations  and   show the <code>confidenceInterval</code> of a fitting. Note that each entry of the matrices is bounded between 0 and 1.</p>

<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">weatherFittedMLE<span class="op">$</span>confidenceInterval</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">weatherFittedBOOT<span class="op">$</span>confidenceInterval</a></code></pre></div>
<pre><code>## $confidenceLevel
## [1] 0.95
## 
## $lowerEndpointMatrix
##           cloudy       rain     sunny
## cloudy 0.3339421 0.32837557 0.2850781
## rain   0.4043309 0.29688665 0.2363956
## sunny  0.2041917 0.09097612 0.6680942
## 
## $upperEndpointMatrix
##           cloudy      rain     sunny
## cloudy 0.3690785 0.3606221 0.3229036
## rain   0.4457396 0.3337180 0.2829292
## sunny  0.2285083 0.1123313 0.6958984</code></pre>
<p>A special function, <code>multinomialConfidenceIntervals</code>, has been written in order to obtain multinomial wise confidence intervals. The code has been based on and Rcpp translation of package’s  functions  that were themselves based on the  paper.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw"><a href="../reference/multinomialConfidenceIntervals.html">multinomialConfidenceIntervals</a></span>(<span class="dt">transitionMatrix =</span> </a>
<a class="sourceLine" id="cb149-2" data-line-number="2">        weatherFittedMLE<span class="op">$</span>estimate<span class="op">@</span>transitionMatrix, </a>
<a class="sourceLine" id="cb149-3" data-line-number="3">        <span class="dt">countsTransitionMatrix =</span> <span class="kw"><a href="../reference/markovchainFit.html">createSequenceMatrix</a></span>(weathersOfDays))</a></code></pre></div>
<pre><code>## $confidenceLevel
## [1] 0.95
## 
## $lowerEndpointMatrix
##           cloudy       rain     sunny
## cloudy 0.2612613 0.24324324 0.1981982
## rain   0.3250000 0.18750000 0.1500000
## sunny  0.1445087 0.04046243 0.6242775
## 
## $upperEndpointMatrix
##           cloudy      rain     sunny
## cloudy 0.4607567 0.4427386 0.3976936
## rain   0.5559026 0.4184026 0.3809026
## sunny  0.2798760 0.1758298 0.7596448</code></pre>
<p>The functions for fitting DTMC have mostly been rewritten in  using   since version 0.2.</p>
<p>It is also possible to fit a DTMC object from <code>matrix</code> or <code>data.frame</code> objects as shown in following code.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(holson)</a>
<a class="sourceLine" id="cb151-2" data-line-number="2">singleMc&lt;-<span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data=</span>holson[,<span class="dv">2</span><span class="op">:</span><span class="dv">12</span>],<span class="dt">name=</span><span class="st">"holson"</span>)</a></code></pre></div>
<p>The same applies for <code>markovchainList</code>.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">mcListFit&lt;-<span class="kw"><a href="../reference/markovchainListFit.html">markovchainListFit</a></span>(<span class="dt">data=</span>holson[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>],<span class="dt">name=</span><span class="st">"holson"</span>)</a>
<a class="sourceLine" id="cb152-2" data-line-number="2">mcListFit<span class="op">$</span>estimate</a></code></pre></div>
<pre><code>## holson  list of Markov chain(s) 
## Markovchain  1 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  1, 2, 3 
##  The transition matrix  (by rows)  is defined as follows: 
##            1          2         3
## 1 0.94609164 0.05390836 0.0000000
## 2 0.26356589 0.62790698 0.1085271
## 3 0.02325581 0.18604651 0.7906977
## 
## Markovchain  2 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  1, 2, 3 
##  The transition matrix  (by rows)  is defined as follows: 
##           1         2         3
## 1 0.9323410 0.0676590 0.0000000
## 2 0.2551724 0.5103448 0.2344828
## 3 0.0000000 0.0862069 0.9137931
## 
## Markovchain  3 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  1, 2, 3 
##  The transition matrix  (by rows)  is defined as follows: 
##            1          2           3
## 1 0.94765840 0.04820937 0.004132231
## 2 0.26119403 0.66417910 0.074626866
## 3 0.01428571 0.13571429 0.850000000
## 
## Markovchain  4 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  1, 2, 3 
##  The transition matrix  (by rows)  is defined as follows: 
##           1          2           3
## 1 0.9172414 0.07724138 0.005517241
## 2 0.1678322 0.60839161 0.223776224
## 3 0.0000000 0.03030303 0.969696970</code></pre>
<p>Finally, given a <code>list</code> object, it is possible to fit a <code>markovchain</code> object or to obtain the raw transition matrix.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">c1&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"a"</span>)</a>
<a class="sourceLine" id="cb154-2" data-line-number="2">c2&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"b"</span>)</a>
<a class="sourceLine" id="cb154-3" data-line-number="3">c3&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"c"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"c"</span>)</a>
<a class="sourceLine" id="cb154-4" data-line-number="4">c4&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"c"</span>,<span class="st">"b"</span>)</a>
<a class="sourceLine" id="cb154-5" data-line-number="5">c5&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"c"</span>,<span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb154-6" data-line-number="6">c6&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"a"</span>)</a>
<a class="sourceLine" id="cb154-7" data-line-number="7">mylist&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(c1,c2,c3,c4,c5,c6)</a>
<a class="sourceLine" id="cb154-8" data-line-number="8">mylistMc&lt;-<span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data=</span>mylist)</a>
<a class="sourceLine" id="cb154-9" data-line-number="9">mylistMc</a></code></pre></div>
<pre><code>## $estimate
## MLE Fit 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  a, b, c 
##  The transition matrix  (by rows)  is defined as follows: 
##     a         b         c
## a 0.4 0.2000000 0.4000000
## b 0.6 0.0000000 0.4000000
## c 0.5 0.3333333 0.1666667
## 
## 
## $standardError
##           a         b         c
## a 0.2000000 0.1414214 0.2000000
## b 0.3464102 0.0000000 0.2828427
## c 0.2886751 0.2357023 0.1666667
## 
## $confidenceLevel
## [1] 0.95
## 
## $lowerEndpointMatrix
##             a b           c
## a 0.008007122 0 0.008007122
## b 0.000000000 0 0.000000000
## c 0.000000000 0 0.000000000
## 
## $upperEndpointMatrix
##           a         b         c
## a 0.7919929 0.4771808 0.7919929
## b 1.0000000 0.0000000 0.9543616
## c 1.0000000 0.7953014 0.4933274</code></pre>
<p>The same works for <code>markovchainFitList</code>.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw"><a href="../reference/markovchainListFit.html">markovchainListFit</a></span>(<span class="dt">data=</span>mylist)</a></code></pre></div>
<pre><code>## $estimate
##   list of Markov chain(s) 
## Markovchain  1 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  a, b, c 
##  The transition matrix  (by rows)  is defined as follows: 
##     a   b   c
## a 0.5 0.5 0.0
## b 0.5 0.0 0.5
## c 1.0 0.0 0.0
## 
## Markovchain  2 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  a, b, c 
##  The transition matrix  (by rows)  is defined as follows: 
##           a         b         c
## a 0.3333333 0.3333333 0.3333333
## b 1.0000000 0.0000000 0.0000000
## c 0.0000000 1.0000000 0.0000000
## 
## Markovchain  3 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  a, b, c 
##  The transition matrix  (by rows)  is defined as follows: 
##           a         b         c
## a 0.5000000 0.0000000 0.5000000
## b 0.5000000 0.0000000 0.5000000
## c 0.3333333 0.3333333 0.3333333
## 
## Markovchain  4 
## Unnamed Markov chain 
##  A  2 - dimensional discrete Markov Chain defined by the following states: 
##  a, c 
##  The transition matrix  (by rows)  is defined as follows: 
##     a   c
## a 0.5 0.5
## c 1.0 0.0
## 
## Markovchain  5 
## Unnamed Markov chain 
##  A  2 - dimensional discrete Markov Chain defined by the following states: 
##  a, c 
##  The transition matrix  (by rows)  is defined as follows: 
##   a c
## a 0 1
## c 0 1
## 
## Markovchain  6 
## Unnamed Markov chain 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  a, b, c 
##  The transition matrix  (by rows)  is defined as follows: 
##           a         b         c
## a 0.3333333 0.3333333 0.3333333
## b 0.3333333 0.3333333 0.3333333
## c 0.5000000 0.5000000 0.0000000</code></pre>
<p>If any transition contains <code>NA</code>, it will be ignored in the results as the above example showed.</p>
</div>
<div id="prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction" class="anchor"></a>Prediction</h2>
<p>The <span class="math inline">\(n\)</span>-step forward predictions can be obtained using the <code>predict</code> methods explicitly written for <code>markovchain</code> and <code>markovchainList</code> objects. The prediction is the mode of the conditional distribution of <span class="math inline">\(X_{t+1}\)</span> given <span class="math inline">\(X_{t}=s_{j}\)</span>, being <span class="math inline">\(s_{j}\)</span> the last realization of the DTMC (homogeneous or non-homogeneous).</p>
<div id="predicting-from-a-markovchain-object" class="section level3">
<h3 class="hasAnchor">
<a href="#predicting-from-a-markovchain-object" class="anchor"></a>Predicting from a markovchain object</h3>
<p>The 3-days forward predictions from <code>markovchain</code> object can be generated as follows, assuming that the last two days were respectively “cloudy” and “sunny”.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(<span class="dt">object =</span> weatherFittedMLE<span class="op">$</span>estimate, <span class="dt">newdata =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"cloudy"</span>, <span class="st">"sunny"</span>),</a>
<a class="sourceLine" id="cb158-2" data-line-number="2">        <span class="dt">n.ahead =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] "sunny" "sunny" "sunny"</code></pre>
</div>
<div id="predicting-from-a-markovchainlist-object" class="section level3">
<h3 class="hasAnchor">
<a href="#predicting-from-a-markovchainlist-object" class="anchor"></a>Predicting from a markovchainList object</h3>
<p>Given an initial two year Healty status, the 5-year ahead prediction of any CCRC guest is</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(mcCCRC, <span class="dt">newdata =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"H"</span>, <span class="st">"H"</span>), <span class="dt">n.ahead =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] "H" "D" "D"</code></pre>
<p>The prediction has stopped at time sequence since the underlying non-homogeneous Markov chain has a length of four. In order to continue five years ahead, the <code>continue=TRUE</code> parameter setting makes the <code>predict</code> method keeping to use the last <code>markovchain</code> in the sequence list.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(mcCCRC, <span class="dt">newdata =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"H"</span>, <span class="st">"H"</span>), <span class="dt">n.ahead =</span> <span class="dv">5</span>, <span class="dt">continue =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] "H" "D" "D" "D" "D"</code></pre>
</div>
</div>
<div id="statistical-tests" class="section level2">
<h2 class="hasAnchor">
<a href="#statistical-tests" class="anchor"></a>Statistical Tests</h2>
<p>In this section, we describe the statistical tests: assessing the Markov property (<code>verifyMarkovProperty</code>), the order (<code>assessOrder</code>), the statinarity (<code>assessStationarity</code>) of a Markov chain sequence, and the divergence test for empirically estimated transition matrices (<code>divergenceTest</code>). Most of such tests are based on the <span class="math inline">\(\chi ^2\)</span> statistics. Relevand references are  and .</p>
<p>All such tests have been designed for small samples, since it is easy to detect departures from Markov property as long as the sample size increases. In addition, the accuracy of the statistical inference functions has been questioned and will be thoroughly investigated in future versions of the package.</p>
<div id="assessing-the-markov-property-of-a-markov-chain-sequence" class="section level3">
<h3 class="hasAnchor">
<a href="#assessing-the-markov-property-of-a-markov-chain-sequence" class="anchor"></a>Assessing the Markov property of a Markov chain sequence</h3>
<p>The <code>verifyMarkovProperty</code> function verifies whether the Markov property holds for the given chain. The test implemented in the package looks at triplets of successive observations. If <span class="math inline">\(x_1, x_2, \ldots, x_N\)</span> is a set of observations and <span class="math inline">\(n_{ijk}\)</span> is the number of times <span class="math inline">\(t\)</span> <span class="math inline">\(\left(1 \le t \le N-2 \right)\)</span> such that <span class="math inline">\(x_t=i, x_{t+1}=j, x_{x+2}=k\)</span>, then if the Markov property holds <span class="math inline">\(n_{ijk}\)</span> follows a Binomial distribution with parameters <span class="math inline">\(n_{ij}\)</span> and <span class="math inline">\(p_{jk}\)</span>. A classical <span class="math inline">\(\chi^2\)</span> test can check this distributional assumption, since <span class="math inline">\(\sum_{i}\sum_{j}\sum_{k}\frac{n_{ijk}-n_{ij}\hat{p_{jk}}}{n_{ij}\hat{p_{jk}}}\sim \chi^2\left(|S|^3 \right )\)</span> where <span class="math inline">\(|S|\)</span> is the cardinality of the state space.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">sample_sequence&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, </a>
<a class="sourceLine" id="cb164-2" data-line-number="2">                   <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>)</a>
<a class="sourceLine" id="cb164-3" data-line-number="3"><span class="kw"><a href="../reference/statisticalTests.html">verifyMarkovProperty</a></span>(sample_sequence)</a></code></pre></div>
<pre><code>## Warning in verifyMarkovProperty(sample_sequence): The accuracy of the
## statistical inference functions has been questioned. It will be thoroughly
## investigated in future versions of the package.</code></pre>
<pre><code>## Testing markovianity property on given data sequence
## Chi - square statistic is: 0.28 
## Degrees of freedom are: 8 
## And corresponding p-value is: 0.9999857</code></pre>
</div>
<div id="assessing-the-order-of-a-markov-chain-sequence" class="section level3">
<h3 class="hasAnchor">
<a href="#assessing-the-order-of-a-markov-chain-sequence" class="anchor"></a>Assessing the order of a Markov chain sequence</h3>
<p>The <code>assessOrder</code> function checks whether the given chain is of first order or of second order. For each possible present state, we construct a contingency table of the frequency of the future state for each past to present state transition as shown in Table .</p>

<p>Using the table, the function performs the <span class="math inline">\(\chi ^2\)</span> test by calling the <code>chisq.test</code> function. This test returns a list of the chi-squared value and the p-value. If the p-value is greater than the given significance level, we cannot reject the hypothesis that the sequence is of first order.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(rain)</a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="kw"><a href="../reference/statisticalTests.html">assessOrder</a></span>(rain<span class="op">$</span>rain)</a></code></pre></div>
<pre><code>## Warning in assessOrder(rain$rain): The accuracy of the statistical
## inference functions has been questioned. It will be thoroughly investigated
## in future versions of the package.</code></pre>
<pre><code>## The assessOrder test statistic is:  26.09575 
## The Chi-Square d.f. are:  12 
## The p-value is:  0.01040395</code></pre>
</div>
<div id="assessing-the-stationarity-of-a-markov-chain-sequence" class="section level3">
<h3 class="hasAnchor">
<a href="#assessing-the-stationarity-of-a-markov-chain-sequence" class="anchor"></a>Assessing the stationarity of a Markov chain sequence</h3>
<p>The <code>assessStationarity</code> function assesses if the transition probabilities of the given chain change over time. To be more specific, the chain is stationary if the following condition meets.</p>

<p>For each possible state, we construct a contingency table of the estimated transition probabilities over time as shown in Table .</p>

<p>Using the table, the function performs the <span class="math inline">\(\chi ^2\)</span> test by calling the <code>chisq.test</code> function. This test returns a list of the chi-squared value and the p-value. If the p-value is greater than the given significance level, we cannot reject the hypothesis that the sequence is stationary.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="kw"><a href="../reference/statisticalTests.html">assessStationarity</a></span>(rain<span class="op">$</span>rain, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## Warning in assessStationarity(rain$rain, 10): The accuracy of the
## statistical inference functions has been questioned. It will be thoroughly
## investigated in future versions of the package.</code></pre>
<pre><code>## Warning in chisq.test(mat): Chi-squared approximation may be incorrect

## Warning in chisq.test(mat): Chi-squared approximation may be incorrect

## Warning in chisq.test(mat): Chi-squared approximation may be incorrect</code></pre>
<pre><code>## The assessStationarity test statistic is:  4.181815 
## The Chi-Square d.f. are:  54 
## The p-value is:  1</code></pre>
</div>
<div id="divergence-tests-for-empirically-estimated-transition-matrices" class="section level3">
<h3 class="hasAnchor">
<a href="#divergence-tests-for-empirically-estimated-transition-matrices" class="anchor"></a>Divergence tests for empirically estimated transition matrices</h3>
<p>This section discusses tests developed to verify whether:</p>
<ol style="list-style-type: decimal">
<li>An empirical transition matrix is consistent with a theoretical one.<br>
</li>
<li>Two or more empirical transition matrices belongs to the same DTMC.</li>
</ol>
<p>The first test is implemented by the <code>verifyEmpiricalToTheoretical</code> function. Bein <span class="math inline">\(f_{ij}\)</span> the raw transition count,  shows that <span class="math inline">\(2*\sum_{i=1}^{r}\sum_{j=1}^{r}f_{ij}\ln\frac{f_{ij}}{f_{i.}P\left( E_j | E_i\right)} \sim \chi^2\left ( r*(r-1) \right )\)</span>. The following example is taken from :</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">sequence&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb174-2" data-line-number="2"><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,</a>
<a class="sourceLine" id="cb174-3" data-line-number="3"><span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb174-4" data-line-number="4"><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb174-5" data-line-number="5"><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb174-6" data-line-number="6">mc=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span><span class="op">/</span><span class="dv">8</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">8</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>,<span class="dv">3</span><span class="op">/</span><span class="dv">8</span>,<span class="dv">3</span><span class="op">/</span><span class="dv">8</span>),<span class="dt">byrow=</span><span class="ot">TRUE</span>, <span class="dt">nrow=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb174-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(mc)&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(mc)&lt;-<span class="dv">0</span><span class="op">:</span><span class="dv">2</span>; theoreticalMc&lt;-<span class="kw">as</span>(mc, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb174-8" data-line-number="8"><span class="kw"><a href="../reference/statisticalTests.html">verifyEmpiricalToTheoretical</a></span>(<span class="dt">data=</span>sequence,<span class="dt">object=</span>theoreticalMc)</a></code></pre></div>
<pre><code>## Warning in verifyEmpiricalToTheoretical(data = sequence, object =
## theoreticalMc): The accuracy of the statistical inference functions has
## been questioned. It will be thoroughly investigated in future versions of
## the package.</code></pre>
<pre><code>## Testing whether the
##    0  1  2
## 0 51 11  8
## 1 12 31  9
## 2  6 11 10
## transition matrix is compatible with
##       0     1     2
## 0 0.625 0.250 0.125
## 1 0.250 0.500 0.250
## 2 0.250 0.375 0.375
## [1] "theoretical transition matrix"
## ChiSq statistic is 6.551795 d.o.f are 6 corresponding p-value is 0.3642899</code></pre>
<pre><code>## $statistic
##        0 
## 6.551795 
## 
## $dof
## [1] 6
## 
## $pvalue
##         0 
## 0.3642899</code></pre>
<p>The second one is implemented by the <code>verifyHomogeneity</code> function, inspired by . Assuming that <span class="math inline">\(i=1,2, \ldots, s\)</span> DTMC samples are available and that the cardinality of the state space is <span class="math inline">\(r\)</span> it verifies whether the <span class="math inline">\(s\)</span> chains belongs to the same unknown one.  shows that its test statistics follows a chi-square law, <span class="math inline">\(2*\sum_{i=1}^{s}\sum_{j=1}^{r}\sum_{k=1}^{r}f_{ijk}\ln\frac{n*f_{ijk}}{f_{i..}f_{.jk}} \sim \chi^2\left ( r*(r-1) \right )\)</span>. Also the following example is taken from :</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(kullback)</a>
<a class="sourceLine" id="cb178-2" data-line-number="2"><span class="kw"><a href="../reference/statisticalTests.html">verifyHomogeneity</a></span>(<span class="dt">inputList=</span>kullback,<span class="dt">verbose=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Warning in verifyHomogeneity(inputList = kullback, verbose = TRUE): The
## accuracy of the statistical inference functions has been questioned. It
## will be thoroughly investigated in future versions of the package.</code></pre>
<pre><code>## Testing homogeneity of DTMC underlying input list 
## ChiSq statistic is 275.9963 d.o.f are 35 corresponding p-value is 0</code></pre>
<pre><code>## $statistic
## [1] 275.9963
## 
## $dof
## [1] 35
## 
## $pvalue
## [1] 0</code></pre>
</div>
</div>
<div id="continuous-times-markov-chains" class="section level2">
<h2 class="hasAnchor">
<a href="#continuous-times-markov-chains" class="anchor"></a>Continuous Times Markov Chains</h2>
<div id="intro" class="section level3">
<h3 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h3>
<p>The  package provides functionality for continuous time Markov chains (CTMCs). CTMCs are a generalisation of discrete time Markov chains (DTMCs) in that we allow time to be continuous. We assume a finite state space <span class="math inline">\(S\)</span> (for an infinite state space wouldn’t fit in memory). We can think of CTMCs as Markov chains in which state transitions can happen at any time.</p>
<p>More formally, we would like our CTMCs to satisfy the following two properties:</p>
<ul>
<li>The Markov property - let <span class="math inline">\(F_{X(s)}\)</span> denote the information about <span class="math inline">\(X\)</span> upto time <span class="math inline">\(s\)</span>. Let <span class="math inline">\(j \in S\)</span> and <span class="math inline">\(s \leq t\)</span>. Then, <span class="math inline">\(P(X(t) = j|F_{X(s)}) = P(X(t) = j|X(s))\)</span>.</li>
<li>Time homogenity - <span class="math inline">\(P(X(t) = j|X(s) = k) = P(X(t-s) = j|X(0) = k)\)</span>.</li>
</ul>
<p>If both the above properties are satisfied, it is referred to as a time-homogeneous CTMC. If a transition occurs at time <span class="math inline">\(t\)</span>, then <span class="math inline">\(X(t)\)</span> denotes the new state and <span class="math inline">\(X(t)\neq X(t-)\)</span>.</p>
<p>Now, let <span class="math inline">\(X(0)=x\)</span> and let <span class="math inline">\(T_x\)</span> be the time a transition occurs from this state. We are interested in the distribution of <span class="math inline">\(T_x\)</span>. For <span class="math inline">\(s,t \geq 0\)</span>, it can be shown that $ P(T_x &gt; s+t | T_x &gt; s) = P(T_x &gt; t) $</p>
<p>This is the memory less property that only the exponential random variable exhibits. Therefore, this is the sought distribution, and each state <span class="math inline">\(s \in S\)</span> has an exponential holding parameter <span class="math inline">\(\lambda(s)\)</span>. Since <span class="math inline">\(\mathrm{E}T_x = \frac{1}{\lambda(x)}\)</span>, higher the rate <span class="math inline">\(\lambda(x)\)</span>, smaller the expected time of transitioning out of the state <span class="math inline">\(x\)</span>.</p>
<p>However, specifying this parameter alone for each state would only paint an incomplete picture of our CTMC. To see why, consider a state <span class="math inline">\(x\)</span> that may transition to either state <span class="math inline">\(y\)</span> or <span class="math inline">\(z\)</span>. The holding parameter enables us to predict when a transition may occur if we start off in state <span class="math inline">\(x\)</span>, but tells us nothing about which state will be next.</p>
<p>To this end, we also need transition probabilities associated with the process, defined as follows (for <span class="math inline">\(y \neq x\)</span>) - <span class="math inline">\(p_{xy} = P(X(T_s) = y | X(0) = x)\)</span>. Note that <span class="math inline">\(\sum_{y \neq x} p_{xy} = 1\)</span>. Let <span class="math inline">\(Q\)</span> denote this transition matrix (<span class="math inline">\(Q_{ij} = p_{ij}\)</span>). What is key here is that <span class="math inline">\(T_x\)</span> and the state <span class="math inline">\(y\)</span> are independent random variables. Let’s define <span class="math inline">\(\lambda(x, y) = \lambda(x) p_{xy}\)</span></p>
<p>We now look at Kolmogorov’s backward equation. Let’s define <span class="math inline">\(P_{ij}(t) = P(X(t) = j | X(0) = i)\)</span> for <span class="math inline">\(i, j \in S\)</span>. The backward equation is given by (it can be proved) <span class="math inline">\(P_{ij}(t) = \delta_{ij}e^{-\lambda(i)t} + \int_{0}^{t}\lambda(i)e^{-\lambda(i)t} \sum_{k \neq i} Q_{ik} P_{kj}(t-s) ds\)</span>. Basically, the first term is non-zero if and only if <span class="math inline">\(i=j\)</span> and represents the probability that the first transition from state <span class="math inline">\(i\)</span> occurs after time <span class="math inline">\(t\)</span>. This would mean that at <span class="math inline">\(t\)</span>, the state is still <span class="math inline">\(i\)</span>. The second term accounts for any transitions that may occur before time <span class="math inline">\(t\)</span> and denotes the probability that at time <span class="math inline">\(t\)</span>, when the smoke clears, we are in state <span class="math inline">\(j\)</span>.</p>
<p>This equation can be represented compactly as follows <span class="math inline">\(P'(t) = AP(t)\)</span> where <span class="math inline">\(A\)</span> is the <em>generator</em> matrix. <span class="math display">\[
A(i, j) = \begin{cases} \lambda(i, j) &amp; \mbox{if } i \neq j \\ -\lambda(i) &amp; \mbox{else.} \end{cases}
\]</span> Observe that the sum of each row is 0. A CTMC can be completely specified by the generator matrix.</p>
</div>
<div id="stationary-distributions" class="section level3">
<h3 class="hasAnchor">
<a href="#stationary-distributions" class="anchor"></a>Stationary Distributions</h3>
<p>The following theorem guarantees the existence of a unique stationary distribution for CTMCs. Note that <span class="math inline">\(X(t)\)</span> being irreducible and recurrent is the same as <span class="math inline">\(X_n(t)\)</span> being irreducible and recurrent.</p>
<p>Suppose that <span class="math inline">\(X(t)\)</span> is irreducible and recurrent. Then <span class="math inline">\(X(t)\)</span> has an invariant measure <span class="math inline">\(\eta\)</span>, which is unique up to multiplicative factors. Moreover, for each <span class="math inline">\(k \in S\)</span>, we have</p>
<p><span class="math display">\[\eta_k = \frac{\pi_k}{\lambda(k)}\]</span></p>
<p>where <span class="math inline">\(\pi\)</span> is the unique invariant measure of the embedded discrete time Markov chain <span class="math inline">\(Xn\)</span>. Finally, <span class="math inline">\(\eta\)</span> satisfies</p>
<p><span class="math display">\[0 &lt; \eta_j &lt; \infty, \forall j \in S\]</span></p>
<p>and if <span class="math inline">\(\sum_i \eta_i &lt; \infty\)</span> then <span class="math inline">\(\eta\)</span> can be normalised to get a stationary distribution.</p>
</div>
<div id="estimation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#estimation-1" class="anchor"></a>Estimation</h3>
<p>Let the data set be <span class="math inline">\(D = \{(s_0, t_0), (s_1, t_1), ..., (s_{N-1}, t_{N-1})\}\)</span> where <span class="math inline">\(N=|D|\)</span>. Each <span class="math inline">\(s_i\)</span> is a state from the state space <span class="math inline">\(S\)</span> and during the time <span class="math inline">\([t_i,t_{i+1}]\)</span> the chain is in state <span class="math inline">\(s_i\)</span>. Let the parameters be represented by <span class="math inline">\(\theta = \{\lambda, P\}\)</span> where <span class="math inline">\(\lambda\)</span> is the vector of holding parameters for each state and <span class="math inline">\(P\)</span> the transition matrix of the embedded discrete time Markov chain.</p>
<p>Then the probability is given by</p>
<p><span class="math display">\[
{Pr(D | \theta) \propto \lambda(s_0)e^{-\lambda(s_0)(t_1-t_0)}Pr(s_1|s_0) \cdot\ldots\cdot \lambda(s_{N-2})e^{-\lambda(s_{N-2})(t_{N-1}-t_{N-2})}Pr(s_{N-1}|s_{N-2})}
\]</span></p>
<p>Let <span class="math inline">\(n(j|i)\)</span> denote the number of <span class="math inline">\(i\)</span>-&gt;<span class="math inline">\(j\)</span> transitions in <span class="math inline">\(D\)</span>, and <span class="math inline">\(n(i)\)</span> the number of times <span class="math inline">\(s_i\)</span> occurs in <span class="math inline">\(D\)</span>. Let <span class="math inline">\(t(s_i)\)</span> denote the total time the chain spends in state <span class="math inline">\(s_i\)</span>.</p>
<p>Then the MLEs are given by</p>
<p><span class="math display">\[
\hat{\lambda(s)} = \frac{n(s)}{t(s)},\hat{Pr(j|i)}=\frac{n(j|i)}{n(i)}
\]</span></p>
</div>
<div id="expected-hitting-time" class="section level3">
<h3 class="hasAnchor">
<a href="#expected-hitting-time" class="anchor"></a>Expected Hitting Time</h3>
<p>The package provides a function <code>ExpectedTime</code> to calculate average hitting time from one state to another. Let the final state be j, then for every state <span class="math inline">\(i \in S\)</span>, where <span class="math inline">\(S\)</span> is the set of all states and holding time <span class="math inline">\(q_{i} &gt; 0\)</span> for every <span class="math inline">\(i \neq j\)</span>. Assuming the conditions to be true, expected hitting time is equal to minimal non-negative solution vector <span class="math inline">\(p\)</span> to the system of linear equations: <span class="math display">\[\begin{equation}
\begin{cases}
      p_{k} = 0 &amp; k = j \\
      -\sum_{l \in I} q_{kl}p_{k} = 1 &amp; k \neq j
\end{cases}
\label{eq:EHT}
\end{equation}\]</span></p>
</div>
<div id="probability-at-time-t" class="section level3">
<h3 class="hasAnchor">
<a href="#probability-at-time-t" class="anchor"></a>Probability at time t</h3>
<p>The package provides a function <code>probabilityatT</code> to calculate probability of every state according to given <code>ctmc</code> object. Here we use Kolmogorov’s backward equation <span class="math inline">\(P(t) = P(0)e^{tQ}\)</span> for <span class="math inline">\(t \geq 0\)</span> and <span class="math inline">\(P(0) = I\)</span>. Here <span class="math inline">\(P(t)\)</span> is the transition function at time t. The value <span class="math inline">\(P(t)[i][j]\)</span> at time <span class="math inline">\(P(t)\)</span> describes the probability of the state at time <span class="math inline">\(t\)</span> to be eqaul to j if it was equal to i at time <span class="math inline">\(t=0\)</span>. It takes care of the case when <code>ctmc</code> object has a generator represented by columns. If inital state is not provided, the function returns the whole transition matrix <span class="math inline">\(P(t)\)</span>.</p>
</div>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h3>
<p>To create a CTMC object, you need to provide a valid generator matrix, say <span class="math inline">\(Q\)</span>. The CTMC object has the following slots - states, generator, byrow, name (look at the documentation object for further details). Consider the following example in which we aim to model the transition of a molecule from the <span class="math inline">\(\sigma\)</span> state to the <span class="math inline">\(\sigma^*\)</span> state. When in the former state, if it absorbs sufficient energy, it can make the jump to the latter state and remains there for some time before transitioning back to the original state. Let us model this by a CTMC:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">energyStates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sigma"</span>, <span class="st">"sigma_star"</span>)</a>
<a class="sourceLine" id="cb182-2" data-line-number="2">byRow &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb182-3" data-line-number="3">gen &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb182-4" data-line-number="4">                       <span class="dv">1</span>, <span class="dv">-1</span>), <span class="dt">nrow =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb182-5" data-line-number="5">              <span class="dt">byrow =</span> byRow, <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(energyStates, energyStates))</a>
<a class="sourceLine" id="cb182-6" data-line-number="6">molecularCTMC &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"ctmc"</span>, <span class="dt">states =</span> energyStates, </a>
<a class="sourceLine" id="cb182-7" data-line-number="7">                 <span class="dt">byrow =</span> byRow, <span class="dt">generator =</span> gen, </a>
<a class="sourceLine" id="cb182-8" data-line-number="8">                 <span class="dt">name =</span> <span class="st">"Molecular Transition Model"</span>)      </a></code></pre></div>
<p>To generate random CTMC transitions, we provide an initial distribution of the states. This must be in the same order as the dimnames of the generator. The output can be returned either as a list or a data frame.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">statesDist &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb183-2" data-line-number="2"><span class="kw"><a href="../reference/rctmc.html">rctmc</a></span>(<span class="dt">n =</span> <span class="dv">3</span>, <span class="dt">ctmc =</span> molecularCTMC, <span class="dt">initDist =</span> statesDist, <span class="dt">out.type =</span> <span class="st">"df"</span>, <span class="dt">include.T0 =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>##       states             time
## 1 sigma_star 1.58606335139813
## 2      sigma 4.76816014547772
## 3 sigma_star  4.8608654514539</code></pre>
<p><span class="math inline">\(n\)</span> represents the number of samples to generate. There is an optional argument <span class="math inline">\(T\)</span> for <code>rctmc</code>. It represents the time of termination of the simulation. To use this feature, set <span class="math inline">\(n\)</span> to a very high value, say <code>Inf</code> (since we do not know the number of transitions before hand) and set <span class="math inline">\(T\)</span> accordingly.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">statesDist &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb185-2" data-line-number="2"><span class="kw"><a href="../reference/rctmc.html">rctmc</a></span>(<span class="dt">n =</span> <span class="ot">Inf</span>, <span class="dt">ctmc =</span> molecularCTMC, <span class="dt">initDist =</span> statesDist, <span class="dt">T =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] "sigma"      "sigma_star" "sigma"      "sigma_star" "sigma"     
## [6] "sigma_star"
## 
## [[2]]
## [1] 0.0000000 0.2605726 0.3874686 0.7683665 1.0622998 1.0638846</code></pre>
<p>To obtain the stationary distribution simply invoke the <code>steadyStates</code> function</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(molecularCTMC)</a></code></pre></div>
<pre><code>##      sigma sigma_star
## [1,]  0.25       0.75</code></pre>
<p>For fitting, use the <code>ctmcFit</code> function. It returns the MLE values for the parameters along with the confidence intervals.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), </a>
<a class="sourceLine" id="cb189-2" data-line-number="2">             <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">2.1</span>, <span class="fl">2.4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="fl">5.9</span>, <span class="fl">8.2</span>, <span class="dv">9</span>))</a>
<a class="sourceLine" id="cb189-3" data-line-number="3"><span class="kw"><a href="../reference/ctmcFit.html">ctmcFit</a></span>(data)</a></code></pre></div>
<pre><code>## $estimate
## An object of class "ctmc"
## Slot "states":
## [1] "a" "b" "c"
## 
## Slot "byrow":
## [1] TRUE
## 
## Slot "generator":
##            a          b          c
## a -0.9090909  0.6060606  0.3030303
## b  0.3225806 -0.9677419  0.6451613
## c  0.3846154  0.3846154 -0.7692308
## 
## Slot "name":
## [1] ""
## 
## 
## $errors
## $errors$dtmcConfidenceInterval
## $errors$dtmcConfidenceInterval$confidenceLevel
## [1] 0.95
## 
## $errors$dtmcConfidenceInterval$lowerEndpointMatrix
##   a b c
## a 0 0 0
## b 0 0 0
## c 0 0 0
## 
## $errors$dtmcConfidenceInterval$upperEndpointMatrix
##           a b         c
## a 0.0000000 1 0.9866548
## b 0.9866548 0 1.0000000
## c 1.0000000 1 0.0000000
## 
## 
## $errors$lambdaConfidenceInterval
## $errors$lambdaConfidenceInterval$lowerEndpointVector
## [1] 0.04576665 0.04871934 0.00000000
## 
## $errors$lambdaConfidenceInterval$upperEndpointVector
## [1]  0.04576665  0.04871934 -0.12545166</code></pre>
<p>One approach to obtain the generator matrix is to apply the <code>logm</code> function from the  package on a transition matrix. Numeric issues arise, see . For example, applying the standard <code>method</code> (‘Higham08’) on <code>mcWeather</code> raises an error, whilst the alternative method (eigenvalue decomposition) is ok. The following code estimates the generator matrix of the <code>mcWeather</code> transition matrix.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">mcWeatherQ &lt;-<span class="st"> </span>expm<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/expm/topics/logm">logm</a></span>(mcWeather<span class="op">@</span>transitionMatrix,<span class="dt">method=</span><span class="st">'Eigen'</span>)</a>
<a class="sourceLine" id="cb191-2" data-line-number="2">mcWeatherQ</a></code></pre></div>
<pre><code>##            sunny     cloudy       rain
## sunny  -0.863221   2.428723  -1.565502
## cloudy  4.284592 -20.116312  15.831720
## rain   -4.414019  24.175251 -19.761232</code></pre>
<p>Therefore, the “half - day” transition probability for mcWeather DTMC is</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1">mcWeatherHalfDayTM &lt;-<span class="st"> </span>expm<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/expm/topics/expm">expm</a></span>(mcWeatherQ<span class="op">*</span>.<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb193-2" data-line-number="2">mcWeatherHalfDay &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>,<span class="dt">transitionMatrix=</span>mcWeatherHalfDayTM,<span class="dt">name=</span><span class="st">"Half Day Weather Transition Matrix"</span>)</a>
<a class="sourceLine" id="cb193-3" data-line-number="3">mcWeatherHalfDay</a></code></pre></div>
<pre><code>## Half Day Weather Transition Matrix 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  sunny, cloudy, rain 
##  The transition matrix  (by rows)  is defined as follows: 
##             sunny    cloudy       rain
## sunny  0.81598647 0.1420068 0.04200677
## cloudy 0.21970167 0.4401492 0.34014916
## rain   0.07063048 0.5146848 0.41468476</code></pre>
<p>The  package  provides various functions to estimate the generator matrix (GM) of a CTMC process using different methods. The following code provides a way to join  and  computations.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(ctmcd)</a></code></pre></div>
<pre><code>## Loading required package: ctmcd</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(expm)</a></code></pre></div>
<pre><code>## Loading required package: expm</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: 'expm'</code></pre>
<pre><code>## The following object is masked from 'package:Matrix':
## 
##     expm</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1"><span class="co">#defines a function to transform a GM into a TM</span></a>
<a class="sourceLine" id="cb202-2" data-line-number="2">gm_to_markovchain&lt;-<span class="cf">function</span>(object, <span class="dt">t=</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb202-3" data-line-number="3">  <span class="cf">if</span>(<span class="op">!</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(object) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"gm"</span>,<span class="st">"matrix"</span>,<span class="st">"Matrix"</span>)))</a>
<a class="sourceLine" id="cb202-4" data-line-number="4">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop</a></span>(<span class="st">"Error! Expecting either a matrix or a gm object"</span>)</a>
<a class="sourceLine" id="cb202-5" data-line-number="5">  <span class="cf">if</span> ( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(object) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"matrix"</span>,<span class="st">"Matrix"</span>)) generator_matrix&lt;-object <span class="cf">else</span> generator_matrix&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(object[[<span class="st">"par"</span>]])</a>
<a class="sourceLine" id="cb202-6" data-line-number="6">  <span class="co">#must add importClassesFrom("markovchain",markovchain) in the NAMESPACE</span></a>
<a class="sourceLine" id="cb202-7" data-line-number="7">  <span class="co">#must add importFrom(expm, "expm")</span></a>
<a class="sourceLine" id="cb202-8" data-line-number="8">  transitionMatrix&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/expm/topics/expm">expm</a></span>(generator_matrix<span class="op">*</span>t)</a>
<a class="sourceLine" id="cb202-9" data-line-number="9">  out&lt;-<span class="kw">as</span>(transitionMatrix,<span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb202-10" data-line-number="10">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb202-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb202-12" data-line-number="12"><span class="co">#loading ctmcd dataset</span></a>
<a class="sourceLine" id="cb202-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(tm_abs)</a>
<a class="sourceLine" id="cb202-14" data-line-number="14">gm0=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">8</span>) <span class="co">#initializing</span></a>
<a class="sourceLine" id="cb202-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(gm0)=<span class="dv">0</span></a>
<a class="sourceLine" id="cb202-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(gm0)=<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(gm0)</a>
<a class="sourceLine" id="cb202-17" data-line-number="17">gm0[<span class="dv">8</span>,]=<span class="dv">0</span></a>
<a class="sourceLine" id="cb202-18" data-line-number="18">gmem=<span class="kw"><a href="https://www.rdocumentation.org/packages/ctmcd/topics/gm">gm</a></span>(tm_abs,<span class="dt">te=</span><span class="dv">1</span>,<span class="dt">method=</span><span class="st">"EM"</span>,<span class="dt">gmguess=</span>gm0) <span class="co">#estimating GM</span></a>
<a class="sourceLine" id="cb202-19" data-line-number="19">mc_at_<span class="dv">2</span>=<span class="kw">gm_to_markovchain</span>(<span class="dt">object=</span>gmem, <span class="dt">t=</span><span class="dv">2</span>) <span class="co">#converting to TM at time 2</span></a></code></pre></div>
</div>
</div>
<div id="pseudo---bayesian-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#pseudo---bayesian-estimation" class="anchor"></a>Pseudo - Bayesian Estimation</h2>
<p> shows an empirical quasi-bayesian method to estimate transition matrices, given an empirical <span class="math inline">\(\hat{P}\)</span> transition matrix (estimated using the classical approach) and an a - priori estimate <span class="math inline">\(Q\)</span>. In particular, each row of the matrix is estimated using the linear combination <span class="math inline">\(\alpha*Q+\left(1-1alpha\right)*P\)</span>, where <span class="math inline">\(\alpha\)</span> is defined for each row as Equation  shows</p>

<p>The following code returns the pseudo bayesian estimate of the transition matrix:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1">pseudoBayesEstimator &lt;-<span class="st"> </span><span class="cf">function</span>(raw, apriori){</a>
<a class="sourceLine" id="cb203-2" data-line-number="2">  v_i &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(raw) </a>
<a class="sourceLine" id="cb203-3" data-line-number="3">  K_i &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(raw))</a>
<a class="sourceLine" id="cb203-4" data-line-number="4">  sumSquaredY &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(raw<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb203-5" data-line-number="5">  <span class="co">#get numerator</span></a>
<a class="sourceLine" id="cb203-6" data-line-number="6">  K_i_num &lt;-<span class="st"> </span>v_i<span class="op">^</span><span class="dv">2</span><span class="op">-</span>sumSquaredY</a>
<a class="sourceLine" id="cb203-7" data-line-number="7">  <span class="co">#get denominator</span></a>
<a class="sourceLine" id="cb203-8" data-line-number="8">  VQ &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>,<span class="dt">nrow=</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(apriori),<span class="dt">ncol=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(apriori))</a>
<a class="sourceLine" id="cb203-9" data-line-number="9">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(VQ)) {</a>
<a class="sourceLine" id="cb203-10" data-line-number="10">    VQ[i,]&lt;-v_i[i]<span class="op">*</span>apriori[i,]</a>
<a class="sourceLine" id="cb203-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb203-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb203-13" data-line-number="13">  K_i_den&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>((raw <span class="op">-</span><span class="st"> </span>VQ)<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb203-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb203-15" data-line-number="15">  K_i &lt;-<span class="st"> </span>K_i_num<span class="op">/</span>K_i_den</a>
<a class="sourceLine" id="cb203-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb203-17" data-line-number="17">  <span class="co">#get the alpha vector</span></a>
<a class="sourceLine" id="cb203-18" data-line-number="18">  alpha &lt;-<span class="st"> </span>K_i <span class="op">/</span><span class="st"> </span>(v_i<span class="op">+</span>K_i)</a>
<a class="sourceLine" id="cb203-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb203-20" data-line-number="20">  <span class="co">#empirical transition matrix</span></a>
<a class="sourceLine" id="cb203-21" data-line-number="21">  Emp&lt;-raw<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(raw)</a>
<a class="sourceLine" id="cb203-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb203-23" data-line-number="23">  <span class="co">#get the estimate</span></a>
<a class="sourceLine" id="cb203-24" data-line-number="24">  out&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>, <span class="dt">nrow=</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(raw),<span class="dt">ncol=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(raw))</a>
<a class="sourceLine" id="cb203-25" data-line-number="25">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(out)) {</a>
<a class="sourceLine" id="cb203-26" data-line-number="26">    out[i,]&lt;-alpha[i]<span class="op">*</span>apriori[i,]<span class="op">+</span>(<span class="dv">1</span><span class="op">-</span>alpha[i])<span class="op">*</span>Emp[i,]</a>
<a class="sourceLine" id="cb203-27" data-line-number="27">  }</a>
<a class="sourceLine" id="cb203-28" data-line-number="28">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb203-29" data-line-number="29">}</a></code></pre></div>
<p>We then apply it to the weather example:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">trueMc&lt;-<span class="kw">as</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.1</span>, <span class="fl">.9</span>,.<span class="dv">7</span>,.<span class="dv">3</span>),<span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="dv">2</span>),<span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb204-2" data-line-number="2">aprioriMc&lt;-<span class="kw">as</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">.5</span>,.<span class="dv">5</span>,.<span class="dv">5</span>),<span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="dv">2</span>),<span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb204-3" data-line-number="3"></a>
<a class="sourceLine" id="cb204-4" data-line-number="4">smallSample&lt;-<span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n=</span><span class="dv">20</span>,<span class="dt">object =</span> trueMc)</a>
<a class="sourceLine" id="cb204-5" data-line-number="5">smallSampleRawTransitions&lt;-<span class="kw"><a href="../reference/markovchainFit.html">createSequenceMatrix</a></span>(<span class="dt">stringchar =</span> smallSample)</a>
<a class="sourceLine" id="cb204-6" data-line-number="6"><span class="kw">pseudoBayesEstimator</span>(</a>
<a class="sourceLine" id="cb204-7" data-line-number="7">  <span class="dt">raw =</span> smallSampleRawTransitions, </a>
<a class="sourceLine" id="cb204-8" data-line-number="8">  <span class="dt">apriori =</span> aprioriMc<span class="op">@</span>transitionMatrix</a>
<a class="sourceLine" id="cb204-9" data-line-number="9">) <span class="op">-</span><span class="st"> </span>trueMc<span class="op">@</span>transitionMatrix</a></code></pre></div>
<pre><code>##            s1         s2
## s1  0.2181818 -0.2181818
## s2 -0.1360190  0.1360190</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">biggerSample&lt;-<span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n=</span><span class="dv">100</span>,<span class="dt">object =</span> trueMc)</a>
<a class="sourceLine" id="cb206-2" data-line-number="2">biggerSampleRawTransitions&lt;-<span class="kw"><a href="../reference/markovchainFit.html">createSequenceMatrix</a></span>(<span class="dt">stringchar =</span> biggerSample)</a>
<a class="sourceLine" id="cb206-3" data-line-number="3"><span class="kw">pseudoBayesEstimator</span>(</a>
<a class="sourceLine" id="cb206-4" data-line-number="4">  <span class="dt">raw =</span> biggerSampleRawTransitions,</a>
<a class="sourceLine" id="cb206-5" data-line-number="5">  <span class="dt">apriori =</span> aprioriMc<span class="op">@</span>transitionMatrix</a>
<a class="sourceLine" id="cb206-6" data-line-number="6">) <span class="op">-</span><span class="st"> </span>trueMc<span class="op">@</span>transitionMatrix</a></code></pre></div>
<pre><code>##              s1          s2
## s1 -0.002212049 0.002212049
## s2 -0.021078102 0.021078102</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">bigSample&lt;-<span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n=</span><span class="dv">1000</span>,<span class="dt">object =</span> trueMc)</a>
<a class="sourceLine" id="cb208-2" data-line-number="2">bigSampleRawTransitions&lt;-<span class="kw"><a href="../reference/markovchainFit.html">createSequenceMatrix</a></span>(<span class="dt">stringchar =</span> bigSample)</a>
<a class="sourceLine" id="cb208-3" data-line-number="3"><span class="kw">pseudoBayesEstimator</span>(</a>
<a class="sourceLine" id="cb208-4" data-line-number="4">  <span class="dt">raw =</span> bigSampleRawTransitions,</a>
<a class="sourceLine" id="cb208-5" data-line-number="5">  <span class="dt">apriori =</span> aprioriMc<span class="op">@</span>transitionMatrix</a>
<a class="sourceLine" id="cb208-6" data-line-number="6">) <span class="op">-</span><span class="st"> </span>trueMc<span class="op">@</span>transitionMatrix</a></code></pre></div>
<pre><code>##             s1          s2
## s1  0.03374693 -0.03374693
## s2 -0.03265830  0.03265830</code></pre>
</div>
<div id="bayesian-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#bayesian-estimation" class="anchor"></a>Bayesian Estimation</h2>
<p>The  package provides functionality for maximum a posteriori (MAP) estimation of the chain parameters (at the time of writing this document, only first order models are supported) by Bayesian inference. It also computes the probability of observing a new data set, given a (different) data set. This vignette provides the mathematical description for the methods employed by the package.</p>
<div id="notation-and-set-up" class="section level3">
<h3 class="hasAnchor">
<a href="#notation-and-set-up" class="anchor"></a>Notation and set-up</h3>
<p>The data is denoted by <span class="math inline">\(D\)</span>, the model parameters (transition matrix) by <span class="math inline">\(\theta\)</span>. The object of interest is <span class="math inline">\(P(\theta | D)\)</span> (posterior density). <span class="math inline">\(\mathcal{A}\)</span> represents an alphabet class, each of whose members represent a state of the chain. Therefore</p>
<p><span class="math display">\[D = s_0 s_1 ... s_{N-1}, s_t \in \mathcal{A}\]</span></p>
<p>where <span class="math inline">\(N\)</span> is the length of the data set. Also,</p>
<p><span class="math display">\[\theta = \{p(s|u), s \in \mathcal{A}, u \in \mathcal{A}  \}\]</span> where <span class="math inline">\(\sum_{s \in \mathcal{A}} p(s|u) = 1\)</span> for each <span class="math inline">\(u \in \mathcal{A}\)</span>.</p>
<p>Our objective is to find <span class="math inline">\(\theta\)</span> which maximises the posterior. That is, if our solution is denoted by <span class="math inline">\(\hat{\theta}\)</span>, then</p>
<p><span class="math display">\[\hat{\theta} = \underset{\theta}{argmax}P(\theta | D)\]</span></p>
<p>where the search space is the set of right stochastic matrices of dimension <span class="math inline">\(|\mathcal{A}|x|\mathcal{A}|\)</span>.</p>
<p><span class="math inline">\(n(u, s)\)</span> denotes the number of times the word <span class="math inline">\(us\)</span> occurs in <span class="math inline">\(D\)</span> and <span class="math inline">\(n(u)=\sum_{s \in \mathcal{A}}n(u, s)\)</span>. The hyperparameters are similarly denoted by <span class="math inline">\(\alpha(u, s)\)</span> and <span class="math inline">\(\alpha(u)\)</span> respectively.</p>
</div>
<div id="methods" class="section level3">
<h3 class="hasAnchor">
<a href="#methods" class="anchor"></a>Methods</h3>
<p>Given <span class="math inline">\(D\)</span>, its likelihood conditioned on the observed initial state in D is given by <span class="math display">\[P(D|\theta) = \prod_{s \in \mathcal{A}} \prod_{u \in \mathcal{A}} p(s|u)^{n(u, s)}\]</span></p>
<p>Conjugate priors are used to model the prior <span class="math inline">\(P(\theta)\)</span>. The reasons are two fold:</p>
<ol style="list-style-type: decimal">
<li>Exact expressions can be derived for the MAP estimates, expectations and even variances</li>
<li>Model order selection/comparison can be implemented easily (available in a future release of the package)</li>
</ol>
<p>The hyperparameters determine the form of the prior distribution, which is a product of Dirichlet distributions</p>
<p><span class="math display">\[P(\theta) = \prod_{u \in \mathcal{A}} \Big\{ \frac{\Gamma(\alpha(u))}{\prod_{s \in \mathcal{A}} \Gamma(\alpha(u, s))} \prod_{s \in \mathcal{A}} p(s|u)^{\alpha(u, s)) - 1} \Big\}\]</span></p>
<p>where <span class="math inline">\(\Gamma(.)\)</span> is the Gamma function. The hyperparameters are specified using the <code>hyperparam</code> argument in the <code>markovchainFit</code> function. If this argument is not specified, then a default value of 1 is assigned to each hyperparameter resulting in the prior distribution of each chain parameter to be uniform over <span class="math inline">\([0,1]\)</span>.</p>
<p>Given the likelihood and the prior as described above, the evidence <span class="math inline">\(P(D)\)</span> is simply given by</p>
<p><span class="math display">\[P(D) = \int P(D|\theta) P(\theta) d\theta\]</span></p>
<p>which simplifies to</p>
<p><span class="math display">\[
P(D) = \prod_{u \in \mathcal{A}} \Big\{ \frac{\Gamma(\alpha(u))}{\prod_{s \in \mathcal{A}} \Gamma(\alpha(u, s))} \frac{\prod_{s \in \mathcal{A}} \Gamma(n(u, s) + \alpha(u, s))}{\Gamma(\alpha(u) + n(u))} \Big\}
\]</span></p>
<p>Using Bayes’ theorem, the posterior now becomes (thanks to the choice of conjugate priors) <span class="math display">\[
P(\theta | D) = \prod_{u \in \mathcal{A}} \Big\{ \frac{\Gamma(n(u) + \alpha(u))}{\prod_{s \in \mathcal{A}} \Gamma(n(u, s) + \alpha(u, s))} \prod_{s \in \mathcal{A}} p(s|u)^{n(u, s) + \alpha(u, s)) - 1} \Big\}
\]</span></p>
<p>Since this is again a product of Dirichlet distributions, the marginalised distribution of a particular parameter <span class="math inline">\(P(s|u)\)</span> of our chain is given by <span class="math display">\[
P(s|u) \sim Beta(n(u, s) + \alpha(u, s), n(u) + \alpha(u) - n(u, s) - \alpha(u, s))
\]</span></p>
<p>Thus, the MAP estimate <span class="math inline">\(\hat{\theta}\)</span> is given by <span class="math display">\[
\hat{\theta} = \Big\{ \frac{n(u, s) + \alpha(u, s) - 1}{n(u) + \alpha(u) - |\mathcal{A}|}, s \in \mathcal{A}, u \in \mathcal{A} \Big\}
\]</span></p>
<p>The function also returns the expected value, given by <span class="math display">\[
\text{E}_{\text{post}} p(s|u) = \Big\{ \frac{n(u, s) + \alpha(u, s)}{n(u) + \alpha(u)}, s \in \mathcal{A}, u \in \mathcal{A} \Big\}
\]</span></p>
<p>The variance is given by <span class="math display">\[
\text{Var}_{\text{post}} p(s|u) = \frac{n(u, s) + \alpha(u, s)}{(n(u) + \alpha(u))^2} \frac{n(u) + \alpha(u) - n(u, s) - \alpha(u, s)}{n(u) + \alpha(u) + 1}
\]</span></p>
<p>The square root of this quantity is the standard error, which is returned by the function.</p>
<p>The confidence intervals are constructed by computing the inverse of the beta integral.</p>
</div>
<div id="predictive-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#predictive-distribution" class="anchor"></a>Predictive distribution</h3>
<p>Given the old data set, the probability of observing new data is <span class="math inline">\(P(D'|D)\)</span> where <span class="math inline">\(D'\)</span> is the new data set. Let <span class="math inline">\(m(u, s), m(u)\)</span> denote the corresponding counts for the new data. Then, <span class="math display">\[
P(D'|D) = \int P(D' | \theta) P(\theta | D) d\theta
\]</span> We already know the expressions for both quantities in the integral and it turns out to be similar to evaluating the evidence <span class="math display">\[
P(D'|D) = \prod_{u \in \mathcal{A}} \Big\{ \frac{\Gamma(\alpha(u))}{\prod_{s \in \mathcal{A}} \Gamma(\alpha(u, s))} \frac{\prod_{s \in \mathcal{A}} \Gamma(n(u, s) + m(u, s) + \alpha(u, s))}{\Gamma(\alpha(u) + n(u) + m(u))} \Big\}
\]</span></p>
</div>
<div id="choosing-the-hyperparameters" class="section level3">
<h3 class="hasAnchor">
<a href="#choosing-the-hyperparameters" class="anchor"></a>Choosing the hyperparameters</h3>
<p>The hyperparameters model the shape of the parameters’ prior distribution. These must be provided by the user. The package offers functionality to translate a given prior belief transition matrix into the hyperparameter matrix. It is assumed that this belief matrix corresponds to the mean value of the parameters. Since the relation <span class="math display">\[
\text{E}_{\text{prior}} p(s | u) = \frac{\alpha(u, s)}{\alpha(u)}
\]</span></p>
<p>holds, the function accepts as input the belief matrix as well as a scaling vector (serves as a proxy for <span class="math inline">\(\alpha(.)\)</span>) and proceeds to compute <span class="math inline">\(\alpha(., .)\)</span>.</p>
<p>Alternatively, the function accepts a data sample and infers the hyperparameters from it. Since the mode of a parameter (with respect to the prior distribution) is proportional to one less than the corresponding hyperparameter, we set</p>
<p><span class="math display">\[
\alpha(u, s) - 1 = m(u, s)
\]</span></p>
<p>where <span class="math inline">\(m(u, s)\)</span> is the <span class="math inline">\(u\rightarrow s\)</span> transition count in the data sample. This is regarded as a ‘fake count’ which helps <span class="math inline">\(\alpha(u, s)\)</span> to reflect knowledge of the data sample.</p>
</div>
<div id="usage-and-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#usage-and-examples" class="anchor"></a>Usage and examples</h3>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">weatherStates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sunny"</span>, <span class="st">"cloudy"</span>, <span class="st">"rain"</span>)</a>
<a class="sourceLine" id="cb210-2" data-line-number="2">byRow &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb210-3" data-line-number="3">weatherMatrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, </a>
<a class="sourceLine" id="cb210-4" data-line-number="4">                                 <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, </a>
<a class="sourceLine" id="cb210-5" data-line-number="5">                                 <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>), </a>
<a class="sourceLine" id="cb210-6" data-line-number="6">                        <span class="dt">byrow =</span> byRow, <span class="dt">nrow =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb210-7" data-line-number="7">                        <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(weatherStates, weatherStates))</a>
<a class="sourceLine" id="cb210-8" data-line-number="8">mcWeather &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> weatherStates, </a>
<a class="sourceLine" id="cb210-9" data-line-number="9">                 <span class="dt">byrow =</span> byRow, <span class="dt">transitionMatrix =</span> weatherMatrix, </a>
<a class="sourceLine" id="cb210-10" data-line-number="10">                 <span class="dt">name =</span> <span class="st">"Weather"</span>)      </a>
<a class="sourceLine" id="cb210-11" data-line-number="11">weathersOfDays &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n =</span> <span class="dv">365</span>, <span class="dt">object =</span> mcWeather, <span class="dt">t0 =</span> <span class="st">"sunny"</span>)</a></code></pre></div>
<p>For the purpose of this section, we shall continue to use the weather of days example introduced in the main vignette of the package (reproduced above for convenience).</p>
<p>Let us invoke the fit function to estimate the MAP parameters with 92% confidence bounds and hyperparameters as shown below, based on the first 200 days of the weather data. Additionally, let us find out what the probability is of observing the weather data for the next 165 days. The usage would be as follows</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1">hyperMatrix&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb211-2" data-line-number="2">                      <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb211-3" data-line-number="3">                      <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), </a>
<a class="sourceLine" id="cb211-4" data-line-number="4">                    <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb211-5" data-line-number="5">                    <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(weatherStates,weatherStates))</a>
<a class="sourceLine" id="cb211-6" data-line-number="6"><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">200</span>], <span class="dt">method =</span> <span class="st">"map"</span>, </a>
<a class="sourceLine" id="cb211-7" data-line-number="7">               <span class="dt">confidencelevel =</span> <span class="fl">0.92</span>, <span class="dt">hyperparam =</span> hyperMatrix)</a></code></pre></div>
<pre><code>## $estimate
## Bayesian Fit 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  cloudy, rain, sunny 
##  The transition matrix  (by rows)  is defined as follows: 
##           cloudy       rain     sunny
## cloudy 0.3913043 0.30434783 0.3043478
## rain   0.4186047 0.30232558 0.2790698
## sunny  0.2315789 0.08421053 0.6842105
## 
## 
## $expectedValue
##           cloudy       rain     sunny
## cloudy 0.3888889 0.30555556 0.3055556
## rain   0.4130435 0.30434783 0.2826087
## sunny  0.2346939 0.09183673 0.6734694
## 
## $standardError
##            [,1]       [,2]       [,3]
## [1,] 0.05705733 0.05391411 0.05391411
## [2,] 0.07182108 0.06711696 0.06567830
## [3,] 0.04259424 0.02902502 0.04713063
## 
## $confidenceInterval
## $confidenceInterval$confidenceLevel
## [1] 0.92
## 
## $confidenceInterval$lowerEndpointMatrix
##           [,1]      [,2]      [,3]
## [1,] 0.3031829 0.2173233 0.2173233
## [2,] 0.3116224 0.1960089 0.1731233
## [3,] 0.1582427 0.0000000 0.6059676
## 
## $confidenceInterval$upperEndpointMatrix
##           [,1]      [,2]      [,3]
## [1,] 0.5139945 0.4067156 0.4067156
## [2,] 0.6155949 0.4319525 0.4019689
## [3,] 0.3067679 0.1349830 1.0000000
## 
## 
## $logLikelihood
## [1] -188.1507</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1"><span class="kw"><a href="../reference/predictiveDistribution.html">predictiveDistribution</a></span>(weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">200</span>], </a>
<a class="sourceLine" id="cb213-2" data-line-number="2">                       weathersOfDays[<span class="dv">201</span><span class="op">:</span><span class="dv">365</span>],<span class="dt">hyperparam =</span> hyperMatrix) </a></code></pre></div>
<pre><code>## [1] -160.1415</code></pre>
<p>The results should not change after permuting the dimensions of the matrix.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">hyperMatrix2&lt;-<span class="st"> </span>hyperMatrix[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>)]</a>
<a class="sourceLine" id="cb215-2" data-line-number="2"><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">200</span>], <span class="dt">method =</span> <span class="st">"map"</span>, </a>
<a class="sourceLine" id="cb215-3" data-line-number="3">               <span class="dt">confidencelevel =</span> <span class="fl">0.92</span>, <span class="dt">hyperparam =</span> hyperMatrix2)</a></code></pre></div>
<pre><code>## $estimate
## Bayesian Fit 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  cloudy, rain, sunny 
##  The transition matrix  (by rows)  is defined as follows: 
##           cloudy       rain     sunny
## cloudy 0.3913043 0.30434783 0.3043478
## rain   0.4186047 0.30232558 0.2790698
## sunny  0.2315789 0.08421053 0.6842105
## 
## 
## $expectedValue
##           cloudy       rain     sunny
## cloudy 0.3888889 0.30555556 0.3055556
## rain   0.4130435 0.30434783 0.2826087
## sunny  0.2346939 0.09183673 0.6734694
## 
## $standardError
##            [,1]       [,2]       [,3]
## [1,] 0.05705733 0.05391411 0.05391411
## [2,] 0.07182108 0.06711696 0.06567830
## [3,] 0.04259424 0.02902502 0.04713063
## 
## $confidenceInterval
## $confidenceInterval$confidenceLevel
## [1] 0.92
## 
## $confidenceInterval$lowerEndpointMatrix
##           [,1]      [,2]      [,3]
## [1,] 0.3031829 0.2173233 0.2173233
## [2,] 0.3116224 0.1960089 0.1731233
## [3,] 0.1582427 0.0000000 0.6059676
## 
## $confidenceInterval$upperEndpointMatrix
##           [,1]      [,2]      [,3]
## [1,] 0.5139945 0.4067156 0.4067156
## [2,] 0.6155949 0.4319525 0.4019689
## [3,] 0.3067679 0.1349830 1.0000000
## 
## 
## $logLikelihood
## [1] -188.1507</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1"><span class="kw"><a href="../reference/predictiveDistribution.html">predictiveDistribution</a></span>(weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">200</span>], </a>
<a class="sourceLine" id="cb217-2" data-line-number="2">                       weathersOfDays[<span class="dv">201</span><span class="op">:</span><span class="dv">365</span>],<span class="dt">hyperparam =</span> hyperMatrix2)</a></code></pre></div>
<pre><code>## [1] -160.1415</code></pre>
<p>Note that the predictive probability is very small. However, this can be useful when comparing model orders. Suppose we have an idea of the (prior) transition matrix corresponding to the expected value of the parameters, and have a data set from which we want to deduce the MAP estimates. We can infer the hyperparameters from this known transition matrix itself, and use this to obtain our MAP estimates.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1"><span class="kw"><a href="../reference/inferHyperparam.html">inferHyperparam</a></span>(<span class="dt">transMatr =</span> weatherMatrix, <span class="dt">scale =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>))</a></code></pre></div>
<pre><code>## $scaledInference
##        cloudy rain sunny
## cloudy      4    3     3
## rain        4    4     2
## sunny       2    1     7</code></pre>
<p>Alternatively, we can use a data sample to infer the hyperparameters.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1"><span class="kw"><a href="../reference/inferHyperparam.html">inferHyperparam</a></span>(<span class="dt">data =</span> weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>])</a></code></pre></div>
<pre><code>## $dataInference
##        cloudy rain
## cloudy      9    4
## rain        4    1</code></pre>
<p>In order to use the inferred hyperparameter matrices, we do</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">hyperMatrix3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/inferHyperparam.html">inferHyperparam</a></span>(<span class="dt">transMatr =</span> weatherMatrix, </a>
<a class="sourceLine" id="cb223-2" data-line-number="2">                                <span class="dt">scale =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb223-3" data-line-number="3">hyperMatrix3 &lt;-<span class="st"> </span>hyperMatrix3<span class="op">$</span>scaledInference</a>
<a class="sourceLine" id="cb223-4" data-line-number="4">hyperMatrix4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/inferHyperparam.html">inferHyperparam</a></span>(<span class="dt">data =</span> weathersOfDays[<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>])</a>
<a class="sourceLine" id="cb223-5" data-line-number="5">hyperMatrix4 &lt;-<span class="st"> </span>hyperMatrix4<span class="op">$</span>dataInference</a></code></pre></div>
<p>Now we can safely use <code>hyperMatrix3</code> and <code>hyperMatrix4</code> with <code>markovchainFit</code> (in the <code>hyperparam</code> argument).</p>
<p>Supposing we don’t provide any hyperparameters, then the prior is uniform. This is the same as maximum likelihood.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(preproglucacon)</a>
<a class="sourceLine" id="cb224-2" data-line-number="2">preproglucacon &lt;-<span class="st"> </span>preproglucacon[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb224-3" data-line-number="3">MLEest &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(preproglucacon, <span class="dt">method =</span> <span class="st">"mle"</span>)</a>
<a class="sourceLine" id="cb224-4" data-line-number="4">MAPest &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(preproglucacon, <span class="dt">method =</span> <span class="st">"map"</span>)</a>
<a class="sourceLine" id="cb224-5" data-line-number="5">MLEest<span class="op">$</span>estimate</a></code></pre></div>
<pre><code>## MLE Fit 
##  A  4 - dimensional discrete Markov Chain defined by the following states: 
##  A, C, G, T 
##  The transition matrix  (by rows)  is defined as follows: 
##           A         C          G         T
## A 0.3585271 0.1434109 0.16666667 0.3313953
## C 0.3840304 0.1558935 0.02281369 0.4372624
## G 0.3053097 0.1991150 0.15044248 0.3451327
## T 0.2844523 0.1819788 0.17667845 0.3568905</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1">MAPest<span class="op">$</span>estimate</a></code></pre></div>
<pre><code>## Bayesian Fit 
##  A  4 - dimensional discrete Markov Chain defined by the following states: 
##  A, C, G, T 
##  The transition matrix  (by rows)  is defined as follows: 
##           A         C          G         T
## A 0.3585271 0.1434109 0.16666667 0.3313953
## C 0.3840304 0.1558935 0.02281369 0.4372624
## G 0.3053097 0.1991150 0.15044248 0.3451327
## T 0.2844523 0.1819788 0.17667845 0.3568905</code></pre>
</div>
</div>
</div>
<div id="sec:applications" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:applications" class="anchor"></a>Applications</h1>
<p>This section shows applications of DTMC in various fields.</p>
<div id="app:weather" class="section level2">
<h2 class="hasAnchor">
<a href="#app:weather" class="anchor"></a>Weather forecasting</h2>
<p>Markov chains provide a simple model to predict the next day’s weather given the current meteorological condition. The first application herewith shown is the “Land of Oz example” from , the second is the “Alofi Island Rainfall” from .</p>
<div id="sec:wfLandOfOz" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:wfLandOfOz" class="anchor"></a>Land of Oz</h3>
<p>The Land of Oz is acknowledged not to have ideal weather conditions at all: the weather is snowy or rainy very often and, once more, there are never two nice days in a row. Consider three weather states: rainy, nice and snowy. Let the transition matrix be as in the following:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">mcWP &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">states =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"rainy"</span>, <span class="st">"nice"</span>, <span class="st">"snowy"</span>),</a>
<a class="sourceLine" id="cb228-2" data-line-number="2">         <span class="dt">transitionMatrix =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>,</a>
<a class="sourceLine" id="cb228-3" data-line-number="3">                                   <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb228-4" data-line-number="4">                                   <span class="fl">0.25</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>), <span class="dt">byrow =</span> T, <span class="dt">nrow =</span> <span class="dv">3</span>))</a></code></pre></div>
<p>Given that today it is a nice day, the corresponding stochastic row vector is <span class="math inline">\(w_{0}=(0\:,1\:,0)\)</span> and the forecast after 1, 2 and 3 days are given by</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1">W0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb229-2" data-line-number="2">W1 &lt;-<span class="st"> </span>W0 <span class="op">*</span><span class="st"> </span>mcWP; W1</a></code></pre></div>
<pre><code>##      rainy nice snowy
## [1,]   0.5    0   0.5</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">W2 &lt;-<span class="st"> </span>W0 <span class="op">*</span><span class="st"> </span>(mcWP <span class="op">^</span><span class="st"> </span><span class="dv">2</span>); W2</a></code></pre></div>
<pre><code>##      rainy nice snowy
## [1,] 0.375 0.25 0.375</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1">W3 &lt;-<span class="st"> </span>W0 <span class="op">*</span><span class="st"> </span>(mcWP <span class="op">^</span><span class="st"> </span><span class="dv">3</span>); W3</a></code></pre></div>
<pre><code>##        rainy   nice   snowy
## [1,] 0.40625 0.1875 0.40625</code></pre>
<p>As can be seen from <span class="math inline">\(w_{1}\)</span>, if in the Land of Oz today is a nice day, tomorrow it will rain or snow with probability 1. One week later, the prediction can be computed as</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">W7 &lt;-<span class="st"> </span>W0 <span class="op">*</span><span class="st"> </span>(mcWP <span class="op">^</span><span class="st"> </span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb235-2" data-line-number="2">W7</a></code></pre></div>
<pre><code>##          rainy      nice     snowy
## [1,] 0.4000244 0.1999512 0.4000244</code></pre>
<p>The steady state of the chain can be computed by means of the <code>steadyStates</code> method.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(mcWP)</a>
<a class="sourceLine" id="cb237-2" data-line-number="2">q</a></code></pre></div>
<pre><code>##      rainy nice snowy
## [1,]   0.4  0.2   0.4</code></pre>
<p>Note that, from the seventh day on, the predicted probabilities are substantially equal to the steady state of the chain and they don’t depend from the starting point, as the following code shows.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">R0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb239-2" data-line-number="2">R7 &lt;-<span class="st"> </span>R0 <span class="op">*</span><span class="st"> </span>(mcWP <span class="op">^</span><span class="st"> </span><span class="dv">7</span>); R7</a></code></pre></div>
<pre><code>##          rainy      nice     snowy
## [1,] 0.4000244 0.2000122 0.3999634</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">S0 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb241-2" data-line-number="2">S7 &lt;-<span class="st"> </span>S0 <span class="op">*</span><span class="st"> </span>(mcWP <span class="op">^</span><span class="st"> </span><span class="dv">7</span>); S7</a></code></pre></div>
<pre><code>##          rainy      nice     snowy
## [1,] 0.3999634 0.2000122 0.4000244</code></pre>
</div>
<div id="sec:wfAlofi" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:wfAlofi" class="anchor"></a>Alofi Island Rainfall</h3>
<p>Alofi Island daily rainfall data were recorded from January 1st, 1987 until December 31st, 1989 and classified into three states: “0” (no rain), “1-5” (from non zero until 5 mm) and “6+” (more than 5mm). The corresponding dataset is provided within the  package.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"rain"</span>, <span class="dt">package =</span> <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb243-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(rain<span class="op">$</span>rain)</a></code></pre></div>
<pre><code>## 
##   0 1-5  6+ 
## 548 295 253</code></pre>
<p>The underlying transition matrix is estimated as follows.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1">mcAlofi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(<span class="dt">data =</span> rain<span class="op">$</span>rain, <span class="dt">name =</span> <span class="st">"Alofi MC"</span>)<span class="op">$</span>estimate</a>
<a class="sourceLine" id="cb245-2" data-line-number="2">mcAlofi</a></code></pre></div>
<pre><code>## Alofi MC 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  0, 1-5, 6+ 
##  The transition matrix  (by rows)  is defined as follows: 
##             0       1-5        6+
## 0   0.6605839 0.2299270 0.1094891
## 1-5 0.4625850 0.3061224 0.2312925
## 6+  0.1976285 0.3122530 0.4901186</code></pre>
<p>The long term daily rainfall distribution is obtained by means of the <code>steadyStates</code> method.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1"><span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(mcAlofi)</a></code></pre></div>
<pre><code>##              0       1-5        6+
## [1,] 0.5008871 0.2693656 0.2297473</code></pre>
</div>
</div>
<div id="app:fin" class="section level2">
<h2 class="hasAnchor">
<a href="#app:fin" class="anchor"></a>Finance and Economics</h2>
<p>Other relevant applications of DTMC can be found in Finance and Economics.</p>
<div id="fin:fin" class="section level3">
<h3 class="hasAnchor">
<a href="#fin:fin" class="anchor"></a>Finance</h3>
<p>Credit ratings transitions have been successfully modelled with discrete time Markov chains. Some rating agencies publish transition matrices that show the empirical transition probabilities across credit ratings. The example that follows comes from   package , carrying Standard &amp; Poor’s published data.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">rc &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"AAA"</span>, <span class="st">"AA"</span>, <span class="st">"A"</span>, <span class="st">"BBB"</span>, <span class="st">"BB"</span>, <span class="st">"B"</span>, <span class="st">"CCC"</span>, <span class="st">"D"</span>)</a>
<a class="sourceLine" id="cb249-2" data-line-number="2">creditMatrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(</a>
<a class="sourceLine" id="cb249-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">90.81</span>, <span class="fl">8.33</span>, <span class="fl">0.68</span>, <span class="fl">0.06</span>, <span class="fl">0.08</span>, <span class="fl">0.02</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb249-4" data-line-number="4">    <span class="fl">0.70</span>, <span class="fl">90.65</span>, <span class="fl">7.79</span>, <span class="fl">0.64</span>, <span class="fl">0.06</span>, <span class="fl">0.13</span>, <span class="fl">0.02</span>, <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb249-5" data-line-number="5">    <span class="fl">0.09</span>, <span class="fl">2.27</span>, <span class="fl">91.05</span>, <span class="fl">5.52</span>, <span class="fl">0.74</span>, <span class="fl">0.26</span>, <span class="fl">0.01</span>, <span class="fl">0.06</span>,</a>
<a class="sourceLine" id="cb249-6" data-line-number="6">    <span class="fl">0.02</span>, <span class="fl">0.33</span>, <span class="fl">5.95</span>, <span class="fl">85.93</span>, <span class="fl">5.30</span>, <span class="fl">1.17</span>, <span class="fl">1.12</span>, <span class="fl">0.18</span>,</a>
<a class="sourceLine" id="cb249-7" data-line-number="7">    <span class="fl">0.03</span>, <span class="fl">0.14</span>, <span class="fl">0.67</span>, <span class="fl">7.73</span>, <span class="fl">80.53</span>, <span class="fl">8.84</span>, <span class="fl">1.00</span>, <span class="fl">1.06</span>,</a>
<a class="sourceLine" id="cb249-8" data-line-number="8">    <span class="fl">0.01</span>, <span class="fl">0.11</span>, <span class="fl">0.24</span>, <span class="fl">0.43</span>, <span class="fl">6.48</span>, <span class="fl">83.46</span>, <span class="fl">4.07</span>, <span class="fl">5.20</span>,</a>
<a class="sourceLine" id="cb249-9" data-line-number="9">    <span class="fl">0.21</span>, <span class="dv">0</span>, <span class="fl">0.22</span>, <span class="fl">1.30</span>, <span class="fl">2.38</span>, <span class="fl">11.24</span>, <span class="fl">64.86</span>, <span class="fl">19.79</span>,</a>
<a class="sourceLine" id="cb249-10" data-line-number="10">    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">100</span></a>
<a class="sourceLine" id="cb249-11" data-line-number="11">   )<span class="op">/</span><span class="dv">100</span>, <span class="dv">8</span>, <span class="dv">8</span>, <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(rc, rc), <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>It is easy to convert such matrices into <code>markovchain</code> objects and to perform some analyses</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">creditMc &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> creditMatrix, </a>
<a class="sourceLine" id="cb250-2" data-line-number="2">                <span class="dt">name =</span> <span class="st">"S&amp;P Matrix"</span>)</a>
<a class="sourceLine" id="cb250-3" data-line-number="3"><span class="kw"><a href="../reference/absorbingStates.html">absorbingStates</a></span>(creditMc)</a></code></pre></div>
<pre><code>## [1] "D"</code></pre>
</div>
<div id="fin:ec" class="section level3">
<h3 class="hasAnchor">
<a href="#fin:ec" class="anchor"></a>Economics</h3>
<p>For a recent application of  in Economic, see .</p>
<p>A dynamic system generates two kinds of economic effects :</p>
<ol style="list-style-type: decimal">
<li>those incurred when the system is in a specified state, and</li>
<li>those incurred when the system makes a transition from one state to another.</li>
</ol>
<p>Let the monetary amount of being in a particular state be represented as a m-dimensional column vector <span class="math inline">\(c^{\rm{S}}\)</span>, while let the monetary amount of a transition be embodied in a <span class="math inline">\(C^{R}\)</span> matrix in which each component specifies the monetary amount of going from state i to state j in a single step. Henceforth, Equation @ref(eq:cost) represents the monetary of being in state <span class="math inline">\(i\)</span>.</p>

<p>Let <span class="math inline">\(\bar c = \left[ c_i \right]\)</span> and let <span class="math inline">\(e_i\)</span> be the vector valued 1 in the initial state and 0 in all other, then, if <span class="math inline">\(f_n\)</span> is the random variable representing the economic return associated with the stochastic process at time <span class="math inline">\(n\)</span>, Equation @ref(eq:return) holds:</p>

<p>The following example assumes that a telephone company models the transition probabilities between customer/non-customer status by matrix <span class="math inline">\(P\)</span> and the cost associated to states by matrix <span class="math inline">\(M\)</span>.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">statesNames &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"customer"</span>, <span class="st">"non customer"</span>)</a>
<a class="sourceLine" id="cb252-2" data-line-number="2">P &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">2</span>); P[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">.9</span>; P[<span class="dv">1</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="fl">.1</span>; P[<span class="dv">2</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="fl">.95</span>; P[<span class="dv">2</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">.05</span>;</a>
<a class="sourceLine" id="cb252-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(P) &lt;-<span class="st"> </span>statesNames; <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(P) &lt;-<span class="st"> </span>statesNames</a>
<a class="sourceLine" id="cb252-4" data-line-number="4">mcP &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> P, <span class="dt">name =</span> <span class="st">"Telephone company"</span>)</a>
<a class="sourceLine" id="cb252-5" data-line-number="5">M &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">2</span>); M[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">-20</span>; M[<span class="dv">1</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">-30</span>; M[<span class="dv">2</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">-40</span>; M[<span class="dv">2</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>If the average revenue for existing customer is +100, the cost per state is computed as follows.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">c1 &lt;-<span class="st"> </span><span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/conditionalDistribution.html">conditionalDistribution</a></span>(mcP, <span class="dt">state =</span> <span class="st">"customer"</span>) <span class="op">%*%</span><span class="st"> </span>M[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb253-2" data-line-number="2">c2 &lt;-<span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/conditionalDistribution.html">conditionalDistribution</a></span>(mcP, <span class="dt">state =</span> <span class="st">"non customer"</span>) <span class="op">%*%</span><span class="st"> </span>M[<span class="dv">2</span>,]</a></code></pre></div>
<p>For an existing customer, the expected gain (loss) at the fifth year is given by the following code.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">0</span>)<span class="op">*</span><span class="st"> </span>mcP <span class="op">^</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%*%</span><span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(c1, c2))))</a></code></pre></div>
<pre><code>## [1] 48.96009</code></pre>
</div>
</div>
<div id="app:act" class="section level2">
<h2 class="hasAnchor">
<a href="#app:act" class="anchor"></a>Actuarial science</h2>
<p>Markov chains are widely applied in the field of actuarial science. Two classical applications are policyholders’ distribution across Bonus Malus classes in Motor Third Party Liability (MTPL) insurance (Section @ref(sec:bm)) and health insurance pricing and reserving (Section @ref(sec:hi)).</p>
<div id="sec:bm" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:bm" class="anchor"></a>MPTL Bonus Malus</h3>
<p>Bonus Malus (BM) contracts grant the policyholder a discount (enworsen) as a function of the number of claims in the experience period. The discount (enworsen) is applied on a premium that already allows for known (a priori) policyholder characteristics  and it usually depends on vehicle, territory, the demographic profile of the policyholder, and policy coverages deep (deductible and policy limits).\ Since the proposed BM level depends on the claim on the previous period, it can be modelled by a discrete Markov chain. A very simplified example follows. Assume a BM scale from 1 to 5, where 4 is the starting level. The evolution rules are shown in Equation :</p>

<p>The number of claim <span class="math inline">\(\tilde N\)</span> is a random variable that is assumed to be Poisson distributed.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1">getBonusMalusMarkovChain &lt;-<span class="st"> </span><span class="cf">function</span>(lambda) {</a>
<a class="sourceLine" id="cb256-2" data-line-number="2">    bmMatr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/ones">zeros</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb256-3" data-line-number="3">    bmMatr[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-4" data-line-number="4">    bmMatr[<span class="dv">1</span>, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">1</span>, lambda)</a>
<a class="sourceLine" id="cb256-5" data-line-number="5">    bmMatr[<span class="dv">1</span>, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">ppois</a></span>(<span class="dt">q =</span> <span class="dv">1</span>, lambda)</a>
<a class="sourceLine" id="cb256-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb256-7" data-line-number="7">    bmMatr[<span class="dv">2</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-8" data-line-number="8">    bmMatr[<span class="dv">2</span>, <span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">1</span>, lambda)</a>
<a class="sourceLine" id="cb256-9" data-line-number="9">    bmMatr[<span class="dv">2</span>, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">ppois</a></span>(<span class="dt">q =</span> <span class="dv">1</span>, lambda)</a>
<a class="sourceLine" id="cb256-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb256-11" data-line-number="11">    bmMatr[<span class="dv">3</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-12" data-line-number="12">    bmMatr[<span class="dv">3</span>, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x=</span><span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-13" data-line-number="13"> </a>
<a class="sourceLine" id="cb256-14" data-line-number="14">    bmMatr[<span class="dv">4</span>, <span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-15" data-line-number="15">    bmMatr[<span class="dv">4</span>, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb256-17" data-line-number="17">    bmMatr[<span class="dv">5</span>, <span class="dv">4</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-18" data-line-number="18">    bmMatr[<span class="dv">5</span>, <span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">dpois</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, lambda)</a>
<a class="sourceLine" id="cb256-19" data-line-number="19">    stateNames &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb256-20" data-line-number="20">    out &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> bmMatr, </a>
<a class="sourceLine" id="cb256-21" data-line-number="21">             <span class="dt">states =</span> stateNames, <span class="dt">name =</span> <span class="st">"BM Matrix"</span>)</a>
<a class="sourceLine" id="cb256-22" data-line-number="22">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(out)</a>
<a class="sourceLine" id="cb256-23" data-line-number="23">}</a></code></pre></div>
<p>Assuming that the a-priori claim frequency per car-year is 0.05 in the class (being the class the group of policyholders that share the same common characteristics), the underlying BM transition matrix and its underlying steady state are as follows.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">bmMc &lt;-<span class="st"> </span><span class="kw">getBonusMalusMarkovChain</span>(<span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(bmMc))</a></code></pre></div>
<pre><code>## [1] 0.895836079 0.045930498 0.048285405 0.005969247 0.003978772</code></pre>
<p>If the underlying BM coefficients of the class are 0.5, 0.7, 0.9, 1.0, 1.25, this means that the average BM coefficient applied on the long run to the class is given by</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/matlab/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(bmMc)) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>, <span class="dv">1</span>, <span class="fl">1.25</span>))</a></code></pre></div>
<pre><code>## [1] 0.534469</code></pre>
<p>This means that the average premium paid by policyholders in the portfolio almost halves in the long run.</p>
</div>
<div id="sec:hi" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:hi" class="anchor"></a>Health insurance example</h3>
<p>Actuaries quantify the risk inherent in insurance contracts evaluating the premium of insurance contract to be sold (therefore covering future risk) and evaluating the actuarial reserves of existing portfolios (the liabilities in terms of benefits or claims payments due to policyholder arising from previously sold contracts), see  for details.</p>
<p>An applied example can be performed using the data from  that has been saved in the <code>exdata</code> folder.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">ltcDemoPath&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"ltdItaData.txt"</span>, </a>
<a class="sourceLine" id="cb261-2" data-line-number="2">                         <span class="dt">package =</span> <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb261-3" data-line-number="3">ltcDemo&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.table</a></span>(<span class="dt">file =</span> ltcDemoPath, <span class="dt">header=</span><span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb261-4" data-line-number="4">                    <span class="dt">sep =</span> <span class="st">";"</span>, <span class="dt">dec =</span> <span class="st">"."</span>)</a>
<a class="sourceLine" id="cb261-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ltcDemo)</a></code></pre></div>
<pre><code>##   age          pAD        pID          pAI       pAA
## 1  20 0.0004616002 0.01083364 0.0001762467 0.9993622
## 2  21 0.0004824888 0.01079719 0.0001710577 0.9993465
## 3  22 0.0004949938 0.01177076 0.0001592333 0.9993458
## 4  23 0.0005042935 0.01159394 0.0001605731 0.9993351
## 5  24 0.0005074193 0.01260574 0.0001606504 0.9993319
## 6  25 0.0005154267 0.01526364 0.0001643603 0.9993202</code></pre>
<p>The data shows the probability of transition between the state of (A)ctive, to (I)ll and Dead. It is easy to complete the transition matrix.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">ltcDemo&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/transform">transform</a></span>(ltcDemo,</a>
<a class="sourceLine" id="cb263-2" data-line-number="2">                   <span class="dt">pIA=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb263-3" data-line-number="3">                   <span class="dt">pII=</span><span class="dv">1</span><span class="op">-</span>pID,</a>
<a class="sourceLine" id="cb263-4" data-line-number="4">                   <span class="dt">pDD=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb263-5" data-line-number="5">                   <span class="dt">pDA=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb263-6" data-line-number="6">                   <span class="dt">pDI=</span><span class="dv">0</span>)</a></code></pre></div>
<p>Now we build a function that returns the transition during the <span class="math inline">\(t+1\)</span> th year, assuming that the subject has attained year <span class="math inline">\(t\)</span>.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">possibleStates&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A"</span>,<span class="st">"I"</span>,<span class="st">"D"</span>)</a>
<a class="sourceLine" id="cb264-2" data-line-number="2">getMc4Age&lt;-<span class="cf">function</span>(age) {</a>
<a class="sourceLine" id="cb264-3" data-line-number="3">  transitionsAtAge&lt;-ltcDemo[ltcDemo<span class="op">$</span>age<span class="op">==</span>age,]</a>
<a class="sourceLine" id="cb264-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb264-5" data-line-number="5">  myTransMatr&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>, <span class="dt">nrow=</span><span class="dv">3</span>,<span class="dt">ncol =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb264-6" data-line-number="6">                      <span class="dt">dimnames =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(possibleStates, possibleStates))</a>
<a class="sourceLine" id="cb264-7" data-line-number="7">  myTransMatr[<span class="dv">1</span>,<span class="dv">1</span>]&lt;-transitionsAtAge<span class="op">$</span>pAA[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb264-8" data-line-number="8">  myTransMatr[<span class="dv">1</span>,<span class="dv">2</span>]&lt;-transitionsAtAge<span class="op">$</span>pAI[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb264-9" data-line-number="9">  myTransMatr[<span class="dv">1</span>,<span class="dv">3</span>]&lt;-transitionsAtAge<span class="op">$</span>pAD[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb264-10" data-line-number="10">  myTransMatr[<span class="dv">2</span>,<span class="dv">2</span>]&lt;-transitionsAtAge<span class="op">$</span>pII[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb264-11" data-line-number="11">  myTransMatr[<span class="dv">2</span>,<span class="dv">3</span>]&lt;-transitionsAtAge<span class="op">$</span>pID[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb264-12" data-line-number="12">  myTransMatr[<span class="dv">3</span>,<span class="dv">3</span>]&lt;-<span class="dv">1</span></a>
<a class="sourceLine" id="cb264-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb264-14" data-line-number="14">  myMc&lt;-<span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> myTransMatr,</a>
<a class="sourceLine" id="cb264-15" data-line-number="15">            <span class="dt">states =</span> possibleStates,</a>
<a class="sourceLine" id="cb264-16" data-line-number="16">            <span class="dt">name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Age"</span>,age,<span class="st">"transition matrix"</span>))</a>
<a class="sourceLine" id="cb264-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb264-18" data-line-number="18">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(myMc)</a>
<a class="sourceLine" id="cb264-19" data-line-number="19"></a>
<a class="sourceLine" id="cb264-20" data-line-number="20">}</a></code></pre></div>
<p>Cause transitions are not homogeneous across ages, we use a <code>markovchainList</code> object to describe the transition probabilities for a guy starting at age 100.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">getFullTransitionTable&lt;-<span class="cf">function</span>(age){</a>
<a class="sourceLine" id="cb265-2" data-line-number="2">  ageSequence&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dt">from=</span>age, <span class="dt">to=</span><span class="dv">120</span>)</a>
<a class="sourceLine" id="cb265-3" data-line-number="3">  k=<span class="dv">1</span></a>
<a class="sourceLine" id="cb265-4" data-line-number="4">  myList=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</a>
<a class="sourceLine" id="cb265-5" data-line-number="5">  <span class="cf">for</span> ( i <span class="cf">in</span> ageSequence) {</a>
<a class="sourceLine" id="cb265-6" data-line-number="6">    mc_age_i&lt;-<span class="kw">getMc4Age</span>(<span class="dt">age =</span> i)</a>
<a class="sourceLine" id="cb265-7" data-line-number="7">    myList[[k]]&lt;-mc_age_i</a>
<a class="sourceLine" id="cb265-8" data-line-number="8">    k=k<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb265-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb265-10" data-line-number="10">  myMarkovChainList&lt;-<span class="kw">new</span>(<span class="st">"markovchainList"</span>, <span class="dt">markovchains =</span> myList,</a>
<a class="sourceLine" id="cb265-11" data-line-number="11">                         <span class="dt">name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"TransitionsSinceAge"</span>, age, <span class="dt">sep =</span> <span class="st">""</span>))</a>
<a class="sourceLine" id="cb265-12" data-line-number="12">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(myMarkovChainList)</a>
<a class="sourceLine" id="cb265-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb265-14" data-line-number="14">transitionsSince100&lt;-<span class="kw">getFullTransitionTable</span>(<span class="dt">age=</span><span class="dv">100</span>)</a></code></pre></div>
<p>We can use such transition for simulating ten life trajectories for a guy that begins “active” (A) aged 100:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1"><span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">object =</span> transitionsSince100,</a>
<a class="sourceLine" id="cb266-2" data-line-number="2">             <span class="dt">what =</span> <span class="st">"matrix"</span>, <span class="dt">t0 =</span> <span class="st">"A"</span>, <span class="dt">include.t0 =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
##  [1,] "A"  "A"  "D"  "D"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [2,] "A"  "A"  "A"  "D"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [3,] "A"  "A"  "A"  "A"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [4,] "A"  "A"  "D"  "D"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [5,] "A"  "A"  "A"  "D"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [6,] "A"  "D"  "D"  "D"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [7,] "A"  "A"  "A"  "A"  "A"  "A"  "A"  "A"  "D"  "D"   "D"   "D"   "D"  
##  [8,] "A"  "A"  "A"  "A"  "A"  "A"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##  [9,] "A"  "A"  "D"  "D"  "D"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
## [10,] "A"  "A"  "A"  "A"  "I"  "D"  "D"  "D"  "D"  "D"   "D"   "D"   "D"  
##       [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22]
##  [1,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [2,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [3,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [4,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [5,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [6,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [7,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [8,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
##  [9,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"  
## [10,] "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"   "D"</code></pre>
<p>Lets consider 1000 simulated live trajectories, for a healty guy aged 80. We can compute the expected time a guy will be disabled starting active at age 80.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">transitionsSince80&lt;-<span class="kw">getFullTransitionTable</span>(<span class="dt">age=</span><span class="dv">80</span>)</a>
<a class="sourceLine" id="cb268-2" data-line-number="2">lifeTrajectories&lt;-<span class="kw"><a href="../reference/rmarkovchain.html">rmarkovchain</a></span>(<span class="dt">n=</span><span class="fl">1e3</span>, <span class="dt">object=</span>transitionsSince80,</a>
<a class="sourceLine" id="cb268-3" data-line-number="3">                               <span class="dt">what=</span><span class="st">"matrix"</span>,<span class="dt">t0=</span><span class="st">"A"</span>,<span class="dt">include.t0=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb268-4" data-line-number="4">temp&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(lifeTrajectories),<span class="dt">ncol =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(lifeTrajectories))</a>
<a class="sourceLine" id="cb268-5" data-line-number="5">temp[lifeTrajectories<span class="op">==</span><span class="st">"I"</span>]&lt;-<span class="dv">1</span></a>
<a class="sourceLine" id="cb268-6" data-line-number="6">expected_period_disabled&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>((temp)))</a>
<a class="sourceLine" id="cb268-7" data-line-number="7">expected_period_disabled</a></code></pre></div>
<pre><code>## [1] 1.258</code></pre>
<p>Assuming that the health insurance will pay a benefit of 12000 per year disabled and that the real interest rate is 0.02, we can compute the lump sum premium at 80.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowMeans</a></span>(<span class="dv">12000</span><span class="op">*</span>temp<span class="op">%*%</span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>((<span class="dv">1</span><span class="fl">+0.02</span>)<span class="op">^-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(temp)<span class="op">-</span><span class="dv">1</span>)))))</a></code></pre></div>
<pre><code>## [1] 12605.85</code></pre>
</div>
</div>
<div id="app:sociology" class="section level2">
<h2 class="hasAnchor">
<a href="#app:sociology" class="anchor"></a>Sociology</h2>
<p>Markov chains have been actively used to model progressions and regressions between social classes. The first study was performed by , while a more recent application can be found in . The table that follows shows the income quartile of the father when the son was 16 (in 1984) and the income quartile of the son when aged 30 (in 2000) for the 1970 cohort.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"blanden"</span>)</a>
<a class="sourceLine" id="cb272-2" data-line-number="2">mobilityMc &lt;-<span class="st"> </span><span class="kw">as</span>(blanden, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb272-3" data-line-number="3">mobilityMc</a></code></pre></div>
<pre><code>## Unnamed Markov chain 
##  A  4 - dimensional discrete Markov Chain defined by the following states: 
##  Bottom, 2nd, 3rd, Top 
##  The transition matrix  (by rows)  is defined as follows: 
##              2nd       3rd    Bottom       Top
## Bottom 0.2900000 0.2200000 0.3800000 0.1100000
## 2nd    0.2772277 0.2574257 0.2475248 0.2178218
## 3rd    0.2626263 0.2828283 0.2121212 0.2424242
## Top    0.1700000 0.2500000 0.1600000 0.4200000</code></pre>
<p>The underlying transition graph is plotted in Figure @ref(fig:mobility).</p>
<div class="figure" style="text-align: center">
<img src="an_introduction_to_markovchain_package_files/figure-html/mobility-1.png" alt="1970 UK cohort mobility data." width="70%"><p class="caption">
1970 UK cohort mobility data.
</p>
</div>
<p>The steady state distribution is computed as follows. Since transition across quartiles are shown, the probability function is evenly 0.25.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="kw"><a href="../reference/steadyStates.html">steadyStates</a></span>(mobilityMc), <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##      Bottom  2nd  3rd  Top
## [1,]   0.25 0.25 0.25 0.25</code></pre>
</div>
<div id="sec:gen" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:gen" class="anchor"></a>Genetics and Medicine</h2>
<p>This section contains two examples: the first shows the use of Markov chain models in genetics, the second shows an application of Markov chains in modelling diseases’ dynamics.</p>
<div id="sec:genetics" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:genetics" class="anchor"></a>Genetics</h3>
<p> discusses the use of Markov chains in model Preprogucacon gene protein bases sequence. The <code>preproglucacon</code> dataset in  contains the dataset shown in the package.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"preproglucacon"</span>, <span class="dt">package =</span> <span class="st">"markovchain"</span>)</a></code></pre></div>
<p>It is possible to model the transition probabilities between bases as shown in the following code.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1">mcProtein &lt;-<span class="st"> </span><span class="kw"><a href="../reference/markovchainFit.html">markovchainFit</a></span>(preproglucacon<span class="op">$</span>preproglucacon, </a>
<a class="sourceLine" id="cb277-2" data-line-number="2">                          <span class="dt">name =</span> <span class="st">"Preproglucacon MC"</span>)<span class="op">$</span>estimate</a>
<a class="sourceLine" id="cb277-3" data-line-number="3">mcProtein</a></code></pre></div>
<pre><code>## Preproglucacon MC 
##  A  4 - dimensional discrete Markov Chain defined by the following states: 
##  A, C, G, T 
##  The transition matrix  (by rows)  is defined as follows: 
##           A         C          G         T
## A 0.3585271 0.1434109 0.16666667 0.3313953
## C 0.3840304 0.1558935 0.02281369 0.4372624
## G 0.3053097 0.1991150 0.15044248 0.3451327
## T 0.2844523 0.1819788 0.17667845 0.3568905</code></pre>
</div>
<div id="sec:medicine" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:medicine" class="anchor"></a>Medicine</h3>
<p>Discrete-time Markov chains are also employed to study the progression of chronic diseases. The following example is taken from . Starting from six month follow-up data, the maximum likelihood estimation of the monthly transition matrix is obtained. This transition matrix aims to describe the monthly progression of CD4-cell counts of HIV infected subjects.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1">craigSendiMatr &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">682</span>, <span class="dv">33</span>, <span class="dv">25</span>,</a>
<a class="sourceLine" id="cb279-2" data-line-number="2">              <span class="dv">154</span>, <span class="dv">64</span>, <span class="dv">47</span>,</a>
<a class="sourceLine" id="cb279-3" data-line-number="3">              <span class="dv">19</span>, <span class="dv">19</span>, <span class="dv">43</span>), <span class="dt">byrow =</span> T, <span class="dt">nrow =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb279-4" data-line-number="4">hivStates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"0-49"</span>, <span class="st">"50-74"</span>, <span class="st">"75-UP"</span>)</a>
<a class="sourceLine" id="cb279-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(craigSendiMatr) &lt;-<span class="st"> </span>hivStates</a>
<a class="sourceLine" id="cb279-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(craigSendiMatr) &lt;-<span class="st"> </span>hivStates</a>
<a class="sourceLine" id="cb279-7" data-line-number="7">craigSendiTable &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">as.table</a></span>(craigSendiMatr)</a>
<a class="sourceLine" id="cb279-8" data-line-number="8">mcM6 &lt;-<span class="st"> </span><span class="kw">as</span>(craigSendiTable, <span class="st">"markovchain"</span>)</a>
<a class="sourceLine" id="cb279-9" data-line-number="9">mcM6<span class="op">@</span>name &lt;-<span class="st"> "Zero-Six month CD4 cells transition"</span></a>
<a class="sourceLine" id="cb279-10" data-line-number="10">mcM6</a></code></pre></div>
<pre><code>## Zero-Six month CD4 cells transition 
##  A  3 - dimensional discrete Markov Chain defined by the following states: 
##  0-49, 50-74, 75-UP 
##  The transition matrix  (by rows)  is defined as follows: 
##            0-49      50-74      75-UP
## 0-49  0.9216216 0.04459459 0.03378378
## 50-74 0.5811321 0.24150943 0.17735849
## 75-UP 0.2345679 0.23456790 0.53086420</code></pre>
<p>As shown in the paper, the second passage consists in the decomposition of <span class="math inline">\(M_{6}=V \cdot D \cdot V^{-1}\)</span> in order to obtain <span class="math inline">\(M_{1}\)</span> as <span class="math inline">\(M_{1}=V \cdot D^{1/6} \cdot V^{-1}\)</span> .</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1">eig &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eigen">eigen</a></span>(mcM6<span class="op">@</span>transitionMatrix)</a>
<a class="sourceLine" id="cb281-2" data-line-number="2">D &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/diag">diag</a></span>(eig<span class="op">$</span>values)</a></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1">V &lt;-<span class="st"> </span>eig<span class="op">$</span>vectors </a>
<a class="sourceLine" id="cb282-2" data-line-number="2">V <span class="op">%*%</span><span class="st"> </span>D <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/solve">solve</a></span>(V)</a></code></pre></div>
<pre><code>##           [,1]       [,2]       [,3]
## [1,] 0.9216216 0.04459459 0.03378378
## [2,] 0.5811321 0.24150943 0.17735849
## [3,] 0.2345679 0.23456790 0.53086420</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1">d &lt;-<span class="st"> </span>D <span class="op">^</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb284-2" data-line-number="2">M &lt;-<span class="st"> </span>V <span class="op">%*%</span><span class="st"> </span>d <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/solve">solve</a></span>(V)</a>
<a class="sourceLine" id="cb284-3" data-line-number="3">mcM1 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"markovchain"</span>, <span class="dt">transitionMatrix =</span> M, <span class="dt">states =</span> hivStates)</a></code></pre></div>
</div>
</div>
</div>
<div id="discussion-issues-and-future-plans" class="section level1">
<h1 class="hasAnchor">
<a href="#discussion-issues-and-future-plans" class="anchor"></a>Discussion, issues and future plans</h1>
<p>The  package has been designed in order to provide easily handling of DTMC and communication with alternative packages.</p>
<p>Some numerical issues have been found when working with matrix algebra using  internal linear algebra kernel (the same calculations performed with  gave a more accurate result). Some temporary workarounds have been implemented. For example, the condition for row/column sums to be equal to one is valid up to fifth decimal. Similarly, when extracting the eigenvectors only the real part is taken.</p>
<p>Such limitations are expected to be overcome in future releases. Similarly, future versions of the package are expected to improve the code in terms of numerical accuracy and rapidity. An intitial rewriting of internal function in  by means of  package  has been started.</p>
</div>
<div id="sec:aknowledgements" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:aknowledgements" class="anchor"></a>Aknowledgments</h1>
<p>The package was selected for Google Summer of Code 2015 support. The authors wish to thank Michael Cole, Tobi Gutman and Mildenberger Thoralf for their suggestions and bug checks. A final thanks also to Dr. Simona C. Minotti and Dr. Mirko Signorelli for their support in drafting this version of the vignettes.</p>

</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-pkg:MmgraphR">
<p>Adamopoulou, Pauline. 2018. <em>MmgraphR: Graphing for Markov, Hidden Markov, and Mixture Transition Distribution Models</em>. <a href="https://CRAN.R-project.org/package=MmgraphR" class="uri">https://CRAN.R-project.org/package=MmgraphR</a>.</p>
</div>
<div id="ref-chambers">
<p>Chambers, J.M. 2008. <em>Software for Data Analysis: Programming with R</em>. Statistics and Computing. Springer-Verlag.</p>
</div>
<div id="ref-pkg:igraph">
<p>Csardi, Gabor, and Tamas Nepusz. 2006. “The Igraph Software Package for Complex Network Research.” <em>InterJournal</em> Complex Systems: 1695. <a href="http://igraph.sf.net" class="uri">http://igraph.sf.net</a>.</p>
</div>
<div id="ref-hmmR">
<p>Dr. Lin Himmelmann, Scientific Software Development -, and www.linhi.com. 2010. <em>HMM: HMM - Hidden Markov Models</em>. <a href="http://CRAN.R-project.org/package=HMM" class="uri">http://CRAN.R-project.org/package=HMM</a>.</p>
</div>
<div id="ref-mcmcR">
<p>Geyer, Charles J., and Leif T. Johnson. 2013. <em>Mcmc: Markov Chain Monte Carlo</em>. <a href="http://CRAN.R-project.org/package=mcmc" class="uri">http://CRAN.R-project.org/package=mcmc</a>.</p>
</div>
<div id="ref-expmR">
<p>Goulet, Vincent, Christophe Dutang, Martin Maechler, David Firth, Marina Shapira, Michael Stadelmann, and expm-developers@lists.R-forge.R-project.org. 2013. <em>Expm: Matrix Exponential</em>. <a href="http://CRAN.R-project.org/package=expm" class="uri">http://CRAN.R-project.org/package=expm</a>.</p>
</div>
<div id="ref-GrinsteadSnell">
<p>Grinstead, Charles M., and Laurie J. Snell. 2006. <em>Grinstead and Snell’s Introduction to Probability</em>. Version dated 4 July 2006. American Mathematical Society. <a href="http://math.dartmouth.edu/%5C~%7B%7Dprob/prob/prob.pdf" class="uri">http://math.dartmouth.edu/\~{}prob/prob/prob.pdf</a>.</p>
</div>
<div id="ref-msmR">
<p>Jackson, Christopher H. 2011. “Multi-State Models for Panel Data: The Msm Package for R.” <em>Journal of Statistical Software</em> 38 (8): 1–29. <a href="http://www.jstatsoft.org/v38/i08/" class="uri">http://www.jstatsoft.org/v38/i08/</a>.</p>
</div>
<div id="ref-DTMCPackR">
<p>Nicholson, William. 2013. <em>DTMCPack: Suite of Functions Related to Discrete-Time Discrete-State Markov Chains</em>. <a href="http://CRAN.R-project.org/package=DTMCPack" class="uri">http://CRAN.R-project.org/package=DTMCPack</a>.</p>
</div>
<div id="ref-noe_constructing_2009">
<p>Noé, Frank, Christof Schütte, Eric Vanden-Eijnden, Lothar Reich, and Thomas R. Weikl. 2009. “Constructing the Equilibrium Ensemble of Folding Pathways from Short Off-Equilibrium Simulations.” <em>Proceedings of the National Academy of Sciences</em> 106 (45): 19011–6. <a href="https://doi.org/10.1073/pnas.0905466106" class="uri">https://doi.org/10.1073/pnas.0905466106</a>.</p>
</div>
<div id="ref-rSoftware">
<p>R Core Team. 2013. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org/" class="uri">http://www.R-project.org/</a>.</p>
</div>
<div id="ref-pkg:matlab">
<p>Roebuck, P. 2011. <em>Matlab: MATLAB Emulation Package</em>. <a href="http://CRAN.R-project.org/package=matlab" class="uri">http://CRAN.R-project.org/package=matlab</a>.</p>
</div>
<div id="ref-pkg:markovchain">
<p>Spedicato, Giorgio Alfredo. 2017. “Discrete Time Markov Chains with R.” <em>The R Journal</em>. <a href="https://journal.r-project.org/archive/2017/RJ-2017-036/index.html" class="uri">https://journal.r-project.org/archive/2017/RJ-2017-036/index.html</a>.</p>
</div>
<div id="ref-mathematica9">
<p>Wolfram Research, Inc. 2013. <em>Mathematica</em>. Ninth. Wolfram Research, Inc.</p>
</div>
<div id="ref-mstateR">
<p>Wreede, Liesbeth C. de, Marta Fiocco, and Hein Putter. 2011. “Mstate: An R Package for the Analysis of Competing Risks and Multi-State Models.” <em>Journal of Statistical Software</em> 38 (7): 1–30. <a href="http://www.jstatsoft.org/v38/i07/" class="uri">http://www.jstatsoft.org/v38/i07/</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#sec:mathematics">Review of core mathematical concepts</a><ul class="nav nav-pills nav-stacked">
<li><a href="#general-definitions">General Definitions</a></li>
      <li><a href="#sec:properties">Properties and classification of states</a></li>
      <li><a href="#a-short-example">A short example</a></li>
      </ul>
</li>
      <li>
<a href="#sec:structure">The structure of the package</a><ul class="nav nav-pills nav-stacked">
<li><a href="#creating-markovchain-objects">Creating markovchain objects</a></li>
      <li><a href="#handling-markovchain-objects">Handling markovchain objects</a></li>
      </ul>
</li>
      <li>
<a href="#sec:probability">Probability with markovchain objects</a><ul class="nav nav-pills nav-stacked">
<li><a href="#conditional-distributions">Conditional distributions</a></li>
      <li><a href="#stationary-states">Stationary states</a></li>
      <li><a href="#classification-of-states">Classification of states</a></li>
      <li><a href="#first-passage-time-distributions-and-means">First passage time distributions and means</a></li>
      <li><a href="#committor-probability">Committor probability</a></li>
      <li><a href="#hitting-probabilities">Hitting probabilities</a></li>
      </ul>
</li>
      <li>
<a href="#sec:statistics">Statistical analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#simulation">Simulation</a></li>
      <li><a href="#estimation">Estimation</a></li>
      <li><a href="#prediction">Prediction</a></li>
      <li><a href="#statistical-tests">Statistical Tests</a></li>
      <li><a href="#continuous-times-markov-chains">Continuous Times Markov Chains</a></li>
      <li><a href="#pseudo---bayesian-estimation">Pseudo - Bayesian Estimation</a></li>
      <li><a href="#bayesian-estimation">Bayesian Estimation</a></li>
      </ul>
</li>
      <li>
<a href="#sec:applications">Applications</a><ul class="nav nav-pills nav-stacked">
<li><a href="#app:weather">Weather forecasting</a></li>
      <li><a href="#app:fin">Finance and Economics</a></li>
      <li><a href="#app:act">Actuarial science</a></li>
      <li><a href="#app:sociology">Sociology</a></li>
      <li><a href="#sec:gen">Genetics and Medicine</a></li>
      </ul>
</li>
      <li><a href="#discussion-issues-and-future-plans">Discussion, issues and future plans</a></li>
      <li><a href="#sec:aknowledgements">Aknowledgments</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Giorgio Alfredo Spedicato, Tae Seung Kang, Sai Bhargav Yalamanchi, Deepak Yadav.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
